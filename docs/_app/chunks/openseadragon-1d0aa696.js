function Re(he,A){return A.forEach(function(e){e&&typeof e!="string"&&!Array.isArray(e)&&Object.keys(e).forEach(function(t){if(t!=="default"&&!(t in he)){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(he,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})}})}),Object.freeze(he)}var be=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Se={exports:{}};(function(he){//! openseadragon 3.0.0
//! Built on 2021-12-15
//! Git commit: v3.0.0-0-3eded36
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function A(e){return new A.Viewer(e)}(function(e){e.version={versionStr:"3.0.0",major:parseInt("3",10),minor:parseInt("0",10),revision:parseInt("0",10)};var t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;e.isFunction=function(u){return e.type(u)==="function"},e.isArray=Array.isArray||function(u){return e.type(u)==="array"},e.isWindow=function(u){return u&&typeof u=="object"&&"setInterval"in u},e.type=function(u){return u==null?String(u):t[i.call(u)]||"object"},e.isPlainObject=function(u){if(!u||A.type(u)!=="object"||u.nodeType||e.isWindow(u)||u.constructor&&!n.call(u,"constructor")&&!n.call(u.constructor.prototype,"isPrototypeOf"))return!1;var a;for(var r in u)a=r;return a===void 0||n.call(u,a)},e.isEmptyObject=function(u){for(var a in u)return!1;return!0},e.freezeObject=function(u){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(a){return a},e.freezeObject(u)},e.supportsCanvas=function(){var u=document.createElement("canvas");return!!(e.isFunction(u.getContext)&&u.getContext("2d"))}(),e.isCanvasTainted=function(u){var a=!1;try{u.getContext("2d").getImageData(0,0,1,1)}catch{a=!0}return a},e.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),e.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),e.supportsEventListenerOptions=function(){var u=0;if(e.supportsAddEventListener)try{var a={get capture(){return u++,!1},get once(){return u++,!1},get passive(){return u++,!1}};window.addEventListener("test",null,a),window.removeEventListener("test",null,a)}catch{u=0}return u>=3}(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var u=document.createElement("canvas").getContext("2d"),a=window.devicePixelRatio||1,r=u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||u.backingStorePixelRatio||1;return Math.max(a,1)/r}else return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()})(A),function(e){e.extend=function(){var r,s,d,g,p,w,T=arguments[0]||{},P=arguments.length,x=!1,R=1;for(typeof T=="boolean"&&(x=T,T=arguments[1]||{},R=2),typeof T!="object"&&!A.isFunction(T)&&(T={}),P===R&&(T=this,--R);R<P;R++)if(r=arguments[R],r!==null||r!==void 0)for(s in r)d=T[s],g=r[s],T!==g&&(x&&g&&(A.isPlainObject(g)||(p=A.isArray(g)))?(p?(p=!1,w=d&&A.isArray(d)?d:[]):w=d&&A.isPlainObject(d)?d:{},T[s]=A.extend(x,w,g)):g!==void 0&&(T[s]=g));return T};var t=function(){if(typeof navigator!="object")return!1;var r=navigator.userAgent;return typeof r!="string"?!1:r.indexOf("iPhone")!==-1||r.indexOf("iPad")!==-1||r.indexOf("iPod")!==-1};e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:t(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(r,s){return function(){var d=arguments;return d===void 0&&(d=[]),s.apply(r,d)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},_viewers:new Map,getViewer:function(r){return e._viewers.get(this.getElement(r))},getElement:function(r){return typeof r=="string"&&(r=document.getElementById(r)),r},getElementPosition:function(r){var s=new e.Point,d,g;for(r=e.getElement(r),d=e.getElementStyle(r).position==="fixed",g=a(r,d);g;)s.x+=r.offsetLeft,s.y+=r.offsetTop,d&&(s=s.plus(e.getPageScroll())),r=g,d=e.getElementStyle(r).position==="fixed",g=a(r,d);return s},getElementOffset:function(r){r=e.getElement(r);var s=r&&r.ownerDocument,d,g,p={top:0,left:0};return s?(d=s.documentElement,typeof r.getBoundingClientRect!="undefined"&&(p=r.getBoundingClientRect()),g=s===s.window?s:s.nodeType===9?s.defaultView||s.parentWindow:!1,new e.Point(p.left+(g.pageXOffset||d.scrollLeft)-(d.clientLeft||0),p.top+(g.pageYOffset||d.scrollTop)-(d.clientTop||0))):new e.Point},getElementSize:function(r){return r=e.getElement(r),new e.Point(r.clientWidth,r.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(r){return r=e.getElement(r),r.currentStyle}:function(r){return r=e.getElement(r),window.getComputedStyle(r,"")},getCssPropertyWithVendorPrefix:function(r){var s={};return e.getCssPropertyWithVendorPrefix=function(d){if(s[d]!==void 0)return s[d];var g=document.createElement("div").style,p=null;if(g[d]!==void 0)p=d;else for(var w=["Webkit","Moz","MS","O","webkit","moz","ms","o"],T=e.capitalizeFirstLetter(d),P=0;P<w.length;P++){var x=w[P]+T;if(g[x]!==void 0){p=x;break}}return s[d]=p,p},e.getCssPropertyWithVendorPrefix(r)},capitalizeFirstLetter:function(r){return r.charAt(0).toUpperCase()+r.slice(1)},positiveModulo:function(r,s){var d=r%s;return d<0&&(d+=s),d},pointInElement:function(r,s){r=e.getElement(r);var d=e.getElementOffset(r),g=e.getElementSize(r);return s.x>=d.x&&s.x<d.x+g.x&&s.y<d.y+g.y&&s.y>=d.y},getMousePosition:function(r){if(typeof r.pageX=="number")e.getMousePosition=function(s){var d=new e.Point;return d.x=s.pageX,d.y=s.pageY,d};else if(typeof r.clientX=="number")e.getMousePosition=function(s){var d=new e.Point;return d.x=s.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d.y=s.clientY+document.body.scrollTop+document.documentElement.scrollTop,d};else throw new Error("Unknown event mouse position, no known technique.");return e.getMousePosition(r)},getPageScroll:function(){var r=document.documentElement||{},s=document.body||{};if(typeof window.pageXOffset=="number")e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(s.scrollLeft||s.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else if(r.scrollLeft||r.scrollTop)e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new e.Point(0,0);return e.getPageScroll()},setPageScroll:function(r){if(typeof window.scrollTo!="undefined")e.setPageScroll=function(g){window.scrollTo(g.x,g.y)};else{var s=e.getPageScroll();if(s.x===r.x&&s.y===r.y)return;document.body.scrollLeft=r.x,document.body.scrollTop=r.y;var d=e.getPageScroll();if(d.x!==s.x&&d.y!==s.y){e.setPageScroll=function(g){document.body.scrollLeft=g.x,document.body.scrollTop=g.y};return}if(document.documentElement.scrollLeft=r.x,document.documentElement.scrollTop=r.y,d=e.getPageScroll(),d.x!==s.x&&d.y!==s.y){e.setPageScroll=function(g){document.documentElement.scrollLeft=g.x,document.documentElement.scrollTop=g.y};return}e.setPageScroll=function(g){}}e.setPageScroll(r)},getWindowSize:function(){var r=document.documentElement||{},s=document.body||{};if(typeof window.innerWidth=="number")e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(r.clientWidth||r.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(s.clientWidth||s.clientHeight)e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return e.getWindowSize()},makeCenteredNode:function(r){r=e.getElement(r);var s=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(s[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(s[1].style,{display:"table-row"}),e.extend(s[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),s[0].appendChild(s[1]),s[1].appendChild(s[2]),s[2].appendChild(r),s[0]},makeNeutralElement:function(r){var s=document.createElement(r),d=s.style;return d.background="transparent none",d.border="none",d.margin="0px",d.padding="0px",d.position="static",s},now:function(){return Date.now?e.now=Date.now:e.now=function(){return new Date().getTime()},e.now()},makeTransparentImage:function(r){var s=e.makeNeutralElement("img");return s.src=r,s},setElementOpacity:function(r,s,d){var g,p;r=e.getElement(r),d&&!e.Browser.alpha&&(s=Math.round(s)),e.Browser.opacity?r.style.opacity=s<1?s:"":s<1?(g=Math.round(100*s),p="alpha(opacity="+g+")",r.style.filter=p):r.style.filter=""},setElementTouchActionNone:function(r){r=e.getElement(r),typeof r.style.touchAction!="undefined"?r.style.touchAction="none":typeof r.style.msTouchAction!="undefined"&&(r.style.msTouchAction="none")},setElementPointerEvents:function(r,s){r=e.getElement(r),typeof r.style.pointerEvents!="undefined"&&(r.style.pointerEvents=s)},setElementPointerEventsNone:function(r){e.setElementPointerEvents(r,"none")},addClass:function(r,s){r=e.getElement(r),r.className?(" "+r.className+" ").indexOf(" "+s+" ")===-1&&(r.className+=" "+s):r.className=s},indexOf:function(r,s,d){return Array.prototype.indexOf?this.indexOf=function(g,p,w){return g.indexOf(p,w)}:this.indexOf=function(g,p,w){var T,P=w||0,x;if(!g)throw new TypeError;if(x=g.length,x===0||P>=x)return-1;for(P<0&&(P=x-Math.abs(P)),T=P;T<x;T++)if(g[T]===p)return T;return-1},this.indexOf(r,s,d)},removeClass:function(r,s){var d,g=[],p;for(r=e.getElement(r),d=r.className.split(/\s+/),p=0;p<d.length;p++)d[p]&&d[p]!==s&&g.push(d[p]);r.className=g.join(" ")},normalizeEventListenerOptions:function(r){var s;return typeof r!="undefined"?typeof r=="boolean"?s=e.supportsEventListenerOptions?{capture:r}:r:s=e.supportsEventListenerOptions?r:typeof r.capture!="undefined"?r.capture:!1:s=e.supportsEventListenerOptions?{capture:!1}:!1,s},addEvent:function(){if(e.supportsAddEventListener)return function(r,s,d,g){g=e.normalizeEventListenerOptions(g),r=e.getElement(r),r.addEventListener(s,d,g)};if(document.documentElement.attachEvent&&document.attachEvent)return function(r,s,d){r=e.getElement(r),r.attachEvent("on"+s,d)};throw new Error("No known event model.")}(),removeEvent:function(){if(e.supportsRemoveEventListener)return function(r,s,d,g){g=e.normalizeEventListenerOptions(g),r=e.getElement(r),r.removeEventListener(s,d,g)};if(document.documentElement.detachEvent&&document.detachEvent)return function(r,s,d){r=e.getElement(r),r.detachEvent("on"+s,d)};throw new Error("No known event model.")}(),cancelEvent:function(r){r.preventDefault()},eventIsCanceled:function(r){return r.defaultPrevented},stopEvent:function(r){r.stopPropagation()},createCallback:function(r,s){var d=[],g;for(g=2;g<arguments.length;g++)d.push(arguments[g]);return function(){var p=d.concat([]),w;for(w=0;w<arguments.length;w++)p.push(arguments[w]);return s.apply(r,p)}},getUrlParameter:function(r){var s=u[r];return s||null},getUrlProtocol:function(r){var s=r.match(/^([a-z]+:)\/\//i);return s===null?window.location.protocol:s[1].toLowerCase()},createAjaxRequest:function(r){var s;try{s=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{s=!1}if(s)window.XMLHttpRequest?e.createAjaxRequest=function(d){return d?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:e.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)e.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return e.createAjaxRequest(r)},makeAjaxRequest:function(r,s,d){var g,p,w;e.isPlainObject(r)&&(s=r.success,d=r.error,g=r.withCredentials,p=r.headers,w=r.responseType||null,r=r.url);var T=e.getUrlProtocol(r),P=e.createAjaxRequest(T==="file:");if(!e.isFunction(s))throw new Error("makeAjaxRequest requires a success callback");P.onreadystatechange=function(){P.readyState===4&&(P.onreadystatechange=function(){},P.status>=200&&P.status<300||P.status===0&&T!=="http:"&&T!=="https:"?s(P):(e.console.log("AJAX request returned %d: %s",P.status,r),e.isFunction(d)&&d(P)))};try{if(P.open("GET",r,!0),w&&(P.responseType=w),p)for(var x in p)Object.prototype.hasOwnProperty.call(p,x)&&p[x]&&P.setRequestHeader(x,p[x]);g&&(P.withCredentials=!0),P.send(null)}catch(R){e.console.log("%s while making AJAX request: %s",R.name,R.message),P.onreadystatechange=function(){},e.isFunction(d)&&d(P,R)}return P},jsonp:function(r){var s,d=r.url,g=document.head||document.getElementsByTagName("head")[0]||document.documentElement,p=r.callbackName||"openseadragon"+e.now(),w=window[p],T="$1"+p+"$2",P=r.param||"callback",x=r.callback;d=d.replace(/(=)\?(&|$)|\?\?/i,T),d+=(/\?/.test(d)?"&":"?")+P+"="+p,window[p]=function(R){if(w)window[p]=w;else try{delete window[p]}catch{}x&&e.isFunction(x)&&x(R)},s=document.createElement("script"),(r.async!==void 0||r.async!==!1)&&(s.async="async"),r.scriptCharset&&(s.charset=r.scriptCharset),s.src=d,s.onload=s.onreadystatechange=function(R,l){(l||!s.readyState||/loaded|complete/.test(s.readyState))&&(s.onload=s.onreadystatechange=null,g&&s.parentNode&&g.removeChild(s),s=void 0)},g.insertBefore(s,g.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(r){if(window.DOMParser)e.parseXml=function(s){var d=null,g;return g=new DOMParser,d=g.parseFromString(s,"text/xml"),d};else if(window.ActiveXObject)e.parseXml=function(s){var d=null;return d=new ActiveXObject("Microsoft.XMLDOM"),d.async=!1,d.loadXML(s),d};else throw new Error("Browser doesn't support XML DOM.");return e.parseXml(r)},parseJSON:function(r){return e.parseJSON=window.JSON.parse,e.parseJSON(r)},imageFormatSupported:function(r){return r=r||"",!!n[r.toLowerCase()]},setImageFormatsSupported:function(r){e.extend(n,r)}});var i=function(r){};e.console=window.console||{log:i,debug:i,info:i,warn:i,error:i,assert:i},e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var n={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},u={};(function(){var r=navigator.appVersion,s=navigator.userAgent,d;switch(navigator.appName){case"Microsoft Internet Explorer":!!window.attachEvent&&!!window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(s.substring(s.indexOf("MSIE")+5,s.indexOf(";",s.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(s.indexOf("Edge")>=0?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(s.substring(s.indexOf("Edge")+5))):s.indexOf("Edg")>=0?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(s.substring(s.indexOf("Edg")+4))):s.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(s.substring(s.indexOf("Firefox")+8))):s.indexOf("Safari")>=0?(e.Browser.vendor=s.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(s.substring(s.substring(0,s.indexOf("Safari")).lastIndexOf("/")+1,s.indexOf("Safari")))):(d=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),d.exec(s)!==null&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(r);break}var g=window.location.search.substring(1),p=g.split("&"),w,T,P;for(P=0;P<p.length;P++)if(w=p[P],T=w.indexOf("="),T>0){var x=w.substring(0,T),R=w.substring(T+1);try{u[x]=decodeURIComponent(R)}catch{e.console.error("Ignoring malformed URL parameter: %s=%s",x,R)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<11&&e.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),function(r){var s=r.requestAnimationFrame||r.mozRequestAnimationFrame||r.webkitRequestAnimationFrame||r.msRequestAnimationFrame,d=r.cancelAnimationFrame||r.mozCancelAnimationFrame||r.webkitCancelAnimationFrame||r.msCancelAnimationFrame;if(s&&d)e.requestAnimationFrame=function(){return s.apply(r,arguments)},e.cancelAnimationFrame=function(){return d.apply(r,arguments)};else{var g=[],p=[],w=0,T;e.requestAnimationFrame=function(P){return g.push([++w,P]),T||(T=setInterval(function(){if(g.length){var x=e.now(),R=p;for(p=g,g=R;p.length;)p.shift()[1](x)}else clearInterval(T),T=void 0},1e3/50)),w},e.cancelAnimationFrame=function(P){var x,R;for(x=0,R=g.length;x<R;x+=1)if(g[x][0]===P){g.splice(x,1);return}for(x=0,R=p.length;x<R;x+=1)if(p[x][0]===P){p.splice(x,1);return}}}}(window);function a(r,s){return s&&r!==document.body?document.body:r.offsetParent}}(A),function(e,t){he.exports?he.exports=t():e.OpenSeadragon=t()}(be,function(){return A}),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(i){return i.requestFullscreen()},t.exitFullScreen=function(){document.exitFullscreen()},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(i){return i.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(i){return i.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(i){return i.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(i){return i.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return t.getFullScreenElement()!==null},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(A),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(t,i,n,u){var a=this;u=u||1;var r=0,s=function(d){r++,r===u&&a.removeHandler(t,s),i(d)};this.addHandler(t,s,n)},addHandler:function(t,i,n){var u=this.events[t];u||(this.events[t]=u=[]),i&&e.isFunction(i)&&(u[u.length]={handler:i,userData:n||null})},removeHandler:function(t,i){var n=this.events[t],u=[],a;if(!!n&&e.isArray(n)){for(a=0;a<n.length;a++)n[a].handler!==i&&u.push(n[a]);this.events[t]=u}},removeAllHandlers:function(t){if(t)this.events[t]=[];else for(var i in this.events)this.events[i]=[]},getHandler:function(t){var i=this.events[t];return!i||!i.length?null:(i=i.length===1?[i[0]]:Array.apply(null,i),function(n,u){var a,r=i.length;for(a=0;a<r;a++)i[a]&&(u.eventSource=n,u.userData=i[a].userData,i[a].handler(u))})},raiseEvent:function(t,i){var n=this.getHandler(t);n&&(i||(i={}),n(this,i))}}}(A),function(e){var t={};e.MouseTracker=function(c){var h=arguments;e.isPlainObject(c)||(c={element:h[0],clickTimeThreshold:h[1],clickDistThreshold:h[2]}),this.hash=Math.random(),this.element=e.getElement(c.element),this.clickTimeThreshold=c.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=c.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=c.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=c.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=c.userData||null,this.stopDelay=c.stopDelay||50,this.preProcessEventHandler=c.preProcessEventHandler||null,this.contextMenuHandler=c.contextMenuHandler||null,this.enterHandler=c.enterHandler||null,this.leaveHandler=c.leaveHandler||null,this.exitHandler=c.exitHandler||null,this.overHandler=c.overHandler||null,this.outHandler=c.outHandler||null,this.pressHandler=c.pressHandler||null,this.nonPrimaryPressHandler=c.nonPrimaryPressHandler||null,this.releaseHandler=c.releaseHandler||null,this.nonPrimaryReleaseHandler=c.nonPrimaryReleaseHandler||null,this.moveHandler=c.moveHandler||null,this.scrollHandler=c.scrollHandler||null,this.clickHandler=c.clickHandler||null,this.dblClickHandler=c.dblClickHandler||null,this.dragHandler=c.dragHandler||null,this.dragEndHandler=c.dragEndHandler||null,this.pinchHandler=c.pinchHandler||null,this.stopHandler=c.stopHandler||null,this.keyDownHandler=c.keyDownHandler||null,this.keyUpHandler=c.keyUpHandler||null,this.keyHandler=c.keyHandler||null,this.focusHandler=c.focusHandler||null,this.blurHandler=c.blurHandler||null;var f=this;t[this.hash]={click:function(m){y(f,m)},dblclick:function(m){E(f,m)},keydown:function(m){S(f,m)},keyup:function(m){b(f,m)},keypress:function(m){O(f,m)},focus:function(m){L(f,m)},blur:function(m){F(f,m)},contextmenu:function(m){G(f,m)},wheel:function(m){V(f,m)},mousewheel:function(m){N(f,m)},DOMMouseScroll:function(m){N(f,m)},MozMousePixelScroll:function(m){N(f,m)},losecapture:function(m){j(f,m)},mouseenter:function(m){de(f,m)},mouseleave:function(m){ue(f,m)},mouseover:function(m){fe(f,m)},mouseout:function(m){pe(f,m)},mousedown:function(m){ge(f,m)},mouseup:function(m){me(f,m)},mousemove:function(m){ye(f,m)},touchstart:function(m){J(f,m)},touchend:function(m){K(f,m)},touchmove:function(m){te(f,m)},touchcancel:function(m){$(f,m)},gesturestart:function(m){ne(f,m)},gesturechange:function(m){M(f,m)},gotpointercapture:function(m){ae(f,m)},lostpointercapture:function(m){Te(f,m)},pointerenter:function(m){de(f,m)},pointerleave:function(m){ue(f,m)},pointerover:function(m){fe(f,m)},pointerout:function(m){pe(f,m)},pointerdown:function(m){ge(f,m)},pointerup:function(m){me(f,m)},pointermove:function(m){ye(f,m)},pointercancel:function(m){o(f,m)},pointerupcaptured:function(m){xe(f,m)},pointermovecaptured:function(m){Ee(f,m)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),c.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){r(this),this.element=null,t[this.hash]=null,delete t[this.hash]},isTracking:function(){return t[this.hash].tracking},setTracking:function(c){return c?a(this):r(this),this},getActivePointersListByType:function(c){var h=t[this.hash],f,m=h.activePointersLists.length,_;for(f=0;f<m;f++)if(h.activePointersLists[f].type===c)return h.activePointersLists[f];return _=new e.MouseTracker.GesturePointList(c),h.activePointersLists.push(_),_},getActivePointerCount:function(){var c=t[this.hash],h,f=c.activePointersLists.length,m=0;for(h=0;h<f;h++)m+=c.activePointersLists[h].getLength();return m},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var i=function(){try{return window.self!==window.top}catch{return!0}}();function n(c){try{return c.addEventListener&&c.removeEventListener}catch{return!1}}e.MouseTracker.gesturePointVelocityTracker=function(){var c=[],h=0,f=0,m=function(Q,W){return Q.hash.toString()+W.type+W.id.toString()},_=function(){var Q,W=c.length,oe,re,ce=e.now(),Pe,Ce,_e;for(Pe=ce-f,f=ce,Q=0;Q<W;Q++)oe=c[Q],re=oe.gPoint,re.direction=Math.atan2(re.currentPos.y-oe.lastPos.y,re.currentPos.x-oe.lastPos.x),Ce=oe.lastPos.distanceTo(re.currentPos),oe.lastPos=re.currentPos,_e=1e3*Ce/(Pe+1),re.speed=.75*_e+.25*re.speed},H=function(Q,W){var oe=m(Q,W);c.push({guid:oe,gPoint:W,lastPos:W.currentPos}),c.length===1&&(f=e.now(),h=window.setInterval(_,50))},I=function(Q,W){var oe=m(Q,W),re,ce=c.length;for(re=0;re<ce;re++)if(c[re].guid===oe){c.splice(re,1),ce--,ce===0&&window.clearInterval(h);break}};return{addPoint:H,removePoint:I}}(),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],e.MouseTracker.wheelEventName==="DOMMouseScroll"&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=function(){var c=document.createElement("div");return e.isFunction(c.setPointerCapture)&&e.isFunction(c.releasePointerCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=function(){var c=document.createElement("div");return e.isFunction(c.setCapture)&&e.isFunction(c.releaseCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(c){this._gPoints=[],this.type=c,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(c){return this._gPoints.push(c)},removeById:function(c){var h,f=this._gPoints.length;for(h=0;h<f;h++)if(this._gPoints[h].id===c){this._gPoints.splice(h,1);break}return this._gPoints.length},getByIndex:function(c){return c<this._gPoints.length?this._gPoints[c]:null},getById:function(c){var h,f=this._gPoints.length;for(h=0;h<f;h++)if(this._gPoints[h].id===c)return this._gPoints[h];return null},getPrimary:function(c){var h,f=this._gPoints.length;for(h=0;h<f;h++)if(this._gPoints[h].isPrimary)return this._gPoints[h];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(e.console.warn("GesturePointList.removeContact() Implausible contacts value"),this.contacts=0)}};function u(c){var h=t[c.hash],f,m,_,H,I,Q=h.activePointersLists.length;for(f=0;f<Q;f++)if(_=h.activePointersLists[f],_.getLength()>0){for(I=[],H=_.asArray(),m=0;m<H.length;m++)I.push(H[m]);for(m=0;m<I.length;m++)C(c,_,I[m])}for(f=0;f<Q;f++)h.activePointersLists.pop();h.sentDragEvent=!1}function a(c){var h=t[c.hash],f,m;if(!h.tracking){for(m=0;m<e.MouseTracker.subscribeEvents.length;m++)f=e.MouseTracker.subscribeEvents[m],e.addEvent(c.element,f,h[f],f===e.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);u(c),h.tracking=!0}}function r(c){var h=t[c.hash],f,m;if(h.tracking){for(m=0;m<e.MouseTracker.subscribeEvents.length;m++)f=e.MouseTracker.subscribeEvents[m],e.removeEvent(c.element,f,h[f],!1);u(c),h.tracking=!1}}function s(c,h){var f=t[c.hash];if(h==="pointerevent")return{upName:"pointerup",upHandler:f.pointerupcaptured,moveName:"pointermove",moveHandler:f.pointermovecaptured};if(h==="mouse")return{upName:"pointerup",upHandler:f.pointerupcaptured,moveName:"pointermove",moveHandler:f.pointermovecaptured};if(h==="touch")return{upName:"touchend",upHandler:f.touchendcaptured,moveName:"touchmove",moveHandler:f.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function d(c,h){var f;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{c.element.setPointerCapture(h.id)}catch{e.console.warn("setPointerCapture() called on invalid pointer ID");return}else c.element.setCapture(!0);else f=s(c,e.MouseTracker.havePointerEvents?"pointerevent":h.type),i&&n(window.top)&&e.addEvent(window.top,f.upName,f.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,f.upName,f.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,f.moveName,f.moveHandler,!0);k(c,h,!0)}function g(c,h){var f,m,_;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(m=c.getActivePointersListByType(h.type),_=m.getById(h.id),!_||!_.captured)return;try{c.element.releasePointerCapture(h.id)}catch{}}else c.element.releaseCapture();else f=s(c,e.MouseTracker.havePointerEvents?"pointerevent":h.type),i&&n(window.top)&&e.removeEvent(window.top,f.upName,f.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,f.moveName,f.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,f.upName,f.upHandler,!0);k(c,h,!1)}function p(c){return e.MouseTracker.havePointerEvents?c.pointerId:e.MouseTracker.mousePointerId}function w(c){return e.MouseTracker.havePointerEvents?c.pointerType||(e.Browser.vendor===e.BROWSERS.IE?"mouse":""):"mouse"}function T(c){return e.MouseTracker.havePointerEvents?c.isPrimary:!0}function P(c){return e.getMousePosition(c)}function x(c,h){return R(P(c),h)}function R(c,h){var f=e.getElementOffset(h);return c.minus(f)}function l(c,h){return new e.Point((c.x+h.x)/2,(c.y+h.y)/2)}function y(c,h){var f={originalEvent:h,eventType:"click",pointerType:"mouse",isEmulated:!1};D(c,f),f.preventDefault&&!f.defaultPrevented&&e.cancelEvent(h),f.stopPropagation&&e.stopEvent(h)}function E(c,h){var f={originalEvent:h,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};D(c,f),f.preventDefault&&!f.defaultPrevented&&e.cancelEvent(h),f.stopPropagation&&e.stopEvent(h)}function S(c,h){var f=null,m={originalEvent:h,eventType:"keydown",pointerType:"",isEmulated:!1};D(c,m),c.keyDownHandler&&!m.preventGesture&&!m.defaultPrevented&&(f={eventSource:c,keyCode:h.keyCode?h.keyCode:h.charCode,ctrl:h.ctrlKey,shift:h.shiftKey,alt:h.altKey,meta:h.metaKey,originalEvent:h,preventDefault:m.preventDefault||m.defaultPrevented,userData:c.userData},c.keyDownHandler(f)),(f&&f.preventDefault||m.preventDefault&&!m.defaultPrevented)&&e.cancelEvent(h),m.stopPropagation&&e.stopEvent(h)}function b(c,h){var f=null,m={originalEvent:h,eventType:"keyup",pointerType:"",isEmulated:!1};D(c,m),c.keyUpHandler&&!m.preventGesture&&!m.defaultPrevented&&(f={eventSource:c,keyCode:h.keyCode?h.keyCode:h.charCode,ctrl:h.ctrlKey,shift:h.shiftKey,alt:h.altKey,meta:h.metaKey,originalEvent:h,preventDefault:m.preventDefault||m.defaultPrevented,userData:c.userData},c.keyUpHandler(f)),(f&&f.preventDefault||m.preventDefault&&!m.defaultPrevented)&&e.cancelEvent(h),m.stopPropagation&&e.stopEvent(h)}function O(c,h){var f=null,m={originalEvent:h,eventType:"keypress",pointerType:"",isEmulated:!1};D(c,m),c.keyHandler&&!m.preventGesture&&!m.defaultPrevented&&(f={eventSource:c,keyCode:h.keyCode?h.keyCode:h.charCode,ctrl:h.ctrlKey,shift:h.shiftKey,alt:h.altKey,meta:h.metaKey,originalEvent:h,preventDefault:m.preventDefault||m.defaultPrevented,userData:c.userData},c.keyHandler(f)),(f&&f.preventDefault||m.preventDefault&&!m.defaultPrevented)&&e.cancelEvent(h),m.stopPropagation&&e.stopEvent(h)}function L(c,h){var f={originalEvent:h,eventType:"focus",pointerType:"",isEmulated:!1};D(c,f),c.focusHandler&&!f.preventGesture&&c.focusHandler({eventSource:c,originalEvent:h,userData:c.userData})}function F(c,h){var f={originalEvent:h,eventType:"blur",pointerType:"",isEmulated:!1};D(c,f),c.blurHandler&&!f.preventGesture&&c.blurHandler({eventSource:c,originalEvent:h,userData:c.userData})}function G(c,h){var f=null,m={originalEvent:h,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};D(c,m),c.contextMenuHandler&&!m.preventGesture&&!m.defaultPrevented&&(f={eventSource:c,position:R(P(h),c.element),originalEvent:m.originalEvent,preventDefault:m.preventDefault||m.defaultPrevented,userData:c.userData},c.contextMenuHandler(f)),(f&&f.preventDefault||m.preventDefault&&!m.defaultPrevented)&&e.cancelEvent(h),m.stopPropagation&&e.stopEvent(h)}function V(c,h){q(c,h,h)}function N(c,h){var f={target:h.target||h.srcElement,type:"wheel",shiftKey:h.shiftKey||!1,clientX:h.clientX,clientY:h.clientY,pageX:h.pageX?h.pageX:h.clientX,pageY:h.pageY?h.pageY:h.clientY,deltaMode:h.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};e.MouseTracker.wheelEventName==="mousewheel"?f.deltaY=-h.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:f.deltaY=h.detail,q(c,f,h)}function q(c,h,f){var m=0,_,H=null;m=h.deltaY<0?1:-1,_={originalEvent:h,eventType:"wheel",pointerType:"mouse",isEmulated:h!==f},D(c,_),c.scrollHandler&&!_.preventGesture&&!_.defaultPrevented&&(H={eventSource:c,pointerType:"mouse",position:x(h,c.element),scroll:m,shift:h.shiftKey,isTouchEvent:!1,originalEvent:f,preventDefault:_.preventDefault||_.defaultPrevented,userData:c.userData},c.scrollHandler(H)),_.stopPropagation&&e.stopEvent(f),(H&&H.preventDefault||_.preventDefault&&!_.defaultPrevented)&&e.cancelEvent(f)}function j(c,h){var f={id:e.MouseTracker.mousePointerId,type:"mouse"},m={originalEvent:h,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};D(c,m),h.target===c.element&&k(c,f,!1),m.stopPropagation&&e.stopEvent(h)}function J(c,h){var f,m,_=h.changedTouches.length,H,I=c.getActivePointersListByType("touch");f=e.now(),I.getLength()>h.touches.length-_&&e.console.warn("Tracked touch contact count doesn't match event.touches.length");var Q={originalEvent:h,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(D(c,Q),m=0;m<_;m++)H={id:h.changedTouches[m].identifier,type:"touch",isPrimary:I.getLength()===0,currentPos:P(h.changedTouches[m]),currentTime:f},z(c,Q,H),U(c,Q,H,0),k(c,H,!0);Q.preventDefault&&!Q.defaultPrevented&&e.cancelEvent(h),Q.stopPropagation&&e.stopEvent(h)}function K(c,h){var f,m,_=h.changedTouches.length,H;f=e.now();var I={originalEvent:h,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(D(c,I),m=0;m<_;m++)H={id:h.changedTouches[m].identifier,type:"touch",currentPos:P(h.changedTouches[m]),currentTime:f},ie(c,I,H,0),k(c,H,!1),Y(c,I,H);I.preventDefault&&!I.defaultPrevented&&e.cancelEvent(h),I.stopPropagation&&e.stopEvent(h)}function te(c,h){var f,m,_=h.changedTouches.length,H;f=e.now();var I={originalEvent:h,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(D(c,I),m=0;m<_;m++)H={id:h.changedTouches[m].identifier,type:"touch",currentPos:P(h.changedTouches[m]),currentTime:f},Z(c,I,H);I.preventDefault&&!I.defaultPrevented&&e.cancelEvent(h),I.stopPropagation&&e.stopEvent(h)}function $(c,h){var f=h.changedTouches.length,m,_,H={originalEvent:h,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(D(c,H),m=0;m<f;m++)_={id:h.changedTouches[m].identifier,type:"touch"},se(c,H,_);H.stopPropagation&&e.stopEvent(h)}function ne(c,h){return e.eventIsCanceled(h)||h.preventDefault(),!1}function M(c,h){return e.eventIsCanceled(h)||h.preventDefault(),!1}function ae(c,h){var f={originalEvent:h,eventType:"gotpointercapture",pointerType:w(h),isEmulated:!1};D(c,f),h.target===c.element&&k(c,{id:h.pointerId,type:w(h)},!0),f.stopPropagation&&e.stopEvent(h)}function Te(c,h){var f={originalEvent:h,eventType:"lostpointercapture",pointerType:w(h),isEmulated:!1};D(c,f),h.target===c.element&&k(c,{id:h.pointerId,type:w(h)},!1),f.stopPropagation&&e.stopEvent(h)}function de(c,h){var f={id:p(h),type:w(h),isPrimary:T(h),currentPos:P(h),currentTime:e.now()},m={originalEvent:h,eventType:"pointerenter",pointerType:f.type,isEmulated:!1};D(c,m),z(c,m,f)}function ue(c,h){var f={id:p(h),type:w(h),isPrimary:T(h),currentPos:P(h),currentTime:e.now()},m={originalEvent:h,eventType:"pointerleave",pointerType:f.type,isEmulated:!1};D(c,m),Y(c,m,f)}function fe(c,h){var f={id:p(h),type:w(h),isPrimary:T(h),currentPos:P(h),currentTime:e.now()},m={originalEvent:h,eventType:"pointerover",pointerType:f.type,isEmulated:!1};D(c,m),ee(c,m,f),m.preventDefault&&!m.defaultPrevented&&e.cancelEvent(h),m.stopPropagation&&e.stopEvent(h)}function pe(c,h){var f={id:p(h),type:w(h),isPrimary:T(h),currentPos:P(h),currentTime:e.now()},m={originalEvent:h,eventType:"pointerout",pointerType:f.type,isEmulated:!1};D(c,m),X(c,m,f),m.preventDefault&&!m.defaultPrevented&&e.cancelEvent(h),m.stopPropagation&&e.stopEvent(h)}function ge(c,h){var f={id:p(h),type:w(h),isPrimary:T(h),currentPos:P(h),currentTime:e.now()},m=e.MouseTracker.havePointerEvents&&f.type==="touch"&&e.Browser.vendor!==e.BROWSERS.IE,_={originalEvent:h,eventType:"pointerdown",pointerType:f.type,isEmulated:!1};D(c,_),U(c,_,f,h.button),_.preventDefault&&!_.defaultPrevented&&e.cancelEvent(h),_.stopPropagation&&e.stopEvent(h),_.shouldCapture&&(m?k(c,f,!0):d(c,f))}function me(c,h){ve(c,h)}function xe(c,h){var f=c.getActivePointersListByType(w(h));f.getById(h.pointerId)&&ve(c,h),e.stopEvent(h)}function ve(c,h){var f;f={id:p(h),type:w(h),isPrimary:T(h),currentPos:P(h),currentTime:e.now()};var m={originalEvent:h,eventType:"pointerup",pointerType:f.type,isEmulated:!1};D(c,m),ie(c,m,f,h.button),m.preventDefault&&!m.defaultPrevented&&e.cancelEvent(h),m.stopPropagation&&e.stopEvent(h),m.shouldReleaseCapture&&(h.target===c.element?g(c,f):k(c,f,!1))}function ye(c,h){we(c,h)}function Ee(c,h){var f=c.getActivePointersListByType(w(h));f.getById(h.pointerId)&&we(c,h),e.stopEvent(h)}function we(c,h){var f={id:p(h),type:w(h),isPrimary:T(h),currentPos:P(h),currentTime:e.now()},m={originalEvent:h,eventType:"pointermove",pointerType:f.type,isEmulated:!1};D(c,m),Z(c,m,f),m.preventDefault&&!m.defaultPrevented&&e.cancelEvent(h),m.stopPropagation&&e.stopEvent(h)}function o(c,h){var f={id:h.pointerId,type:w(h)},m={originalEvent:h,eventType:"pointercancel",pointerType:f.type,isEmulated:!1};D(c,m),se(c,m,f),m.stopPropagation&&e.stopEvent(h)}function v(c,h){return h.speed=0,h.direction=0,h.contactPos=h.currentPos,h.contactTime=h.currentTime,h.lastPos=h.currentPos,h.lastTime=h.currentTime,c.add(h)}function C(c,h,f){var m,_=h.getById(f.id);return _?(_.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),g(c,_)),(h.type==="mouse"||h.type==="pen")&&h.contacts>0&&h.removeContact(),m=h.removeById(f.id)):m=h.getLength(),m}function B(c,h){switch(h.eventType){case"pointermove":h.isStoppable=!0,h.isCancelable=!0,h.preventDefault=!1,h.preventGesture=!c.hasGestureHandlers,h.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":h.isStoppable=!0,h.isCancelable=!0,h.preventDefault=!1,h.preventGesture=!1,h.stopPropagation=!1;break;case"pointerdown":h.isStoppable=!0,h.isCancelable=!0,h.preventDefault=!1,h.preventGesture=!c.hasGestureHandlers,h.stopPropagation=!1;break;case"pointerup":h.isStoppable=!0,h.isCancelable=!0,h.preventDefault=!1,h.preventGesture=!c.hasGestureHandlers,h.stopPropagation=!1;break;case"wheel":h.isStoppable=!0,h.isCancelable=!0,h.preventDefault=!1,h.preventGesture=!c.hasScrollHandler,h.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":h.isStoppable=!0,h.isCancelable=!1,h.preventDefault=!1,h.preventGesture=!1,h.stopPropagation=!1;break;case"click":h.isStoppable=!0,h.isCancelable=!0,h.preventDefault=!!c.clickHandler,h.preventGesture=!1,h.stopPropagation=!1;break;case"dblclick":h.isStoppable=!0,h.isCancelable=!0,h.preventDefault=!!c.dblClickHandler,h.preventGesture=!1,h.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:h.isStoppable=!1,h.isCancelable=!1,h.preventDefault=!1,h.preventGesture=!1,h.stopPropagation=!1;break}}function D(c,h){h.eventSource=c,h.eventPhase=h.originalEvent&&typeof h.originalEvent.eventPhase!="undefined"?h.originalEvent.eventPhase:0,h.defaultPrevented=e.eventIsCanceled(h.originalEvent),h.shouldCapture=!1,h.shouldReleaseCapture=!1,h.userData=c.userData,B(c,h),c.preProcessEventHandler&&c.preProcessEventHandler(h)}function k(c,h,f){var m=c.getActivePointersListByType(h.type),_=m.getById(h.id);_?f&&!_.captured?(_.captured=!0,m.captureCount++):!f&&_.captured&&(_.captured=!1,m.captureCount--,m.captureCount<0&&(m.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function z(c,h,f){var m=c.getActivePointersListByType(f.type),_;_=m.getById(f.id),_?(_.insideElement=!0,_.lastPos=_.currentPos,_.lastTime=_.currentTime,_.currentPos=f.currentPos,_.currentTime=f.currentTime,f=_):(f.captured=!1,f.insideElementPressed=!1,f.insideElement=!0,v(m,f)),c.enterHandler&&c.enterHandler({eventSource:c,pointerType:f.type,position:R(f.currentPos,c.element),buttons:m.buttons,pointers:c.getActivePointerCount(),insideElementPressed:f.insideElementPressed,buttonDownAny:m.buttons!==0,isTouchEvent:f.type==="touch",originalEvent:h.originalEvent,userData:c.userData})}function Y(c,h,f){var m=c.getActivePointersListByType(f.type),_,H;_=m.getById(f.id),_?(_.captured?(_.insideElement=!1,_.lastPos=_.currentPos,_.lastTime=_.currentTime,_.currentPos=f.currentPos,_.currentTime=f.currentTime):C(c,m,_),f=_):(f.captured=!1,f.insideElementPressed=!1),(c.leaveHandler||c.exitHandler)&&(H={eventSource:c,pointerType:f.type,position:f.currentPos&&R(f.currentPos,c.element),buttons:m.buttons,pointers:c.getActivePointerCount(),insideElementPressed:f.insideElementPressed,buttonDownAny:m.buttons!==0,isTouchEvent:f.type==="touch",originalEvent:h.originalEvent,userData:c.userData},c.leaveHandler&&c.leaveHandler(H),c.exitHandler&&c.exitHandler(H))}function ee(c,h,f){var m,_;m=c.getActivePointersListByType(f.type),_=m.getById(f.id),_?f=_:(f.captured=!1,f.insideElementPressed=!1),c.overHandler&&c.overHandler({eventSource:c,pointerType:f.type,position:R(f.currentPos,c.element),buttons:m.buttons,pointers:c.getActivePointerCount(),insideElementPressed:f.insideElementPressed,buttonDownAny:m.buttons!==0,isTouchEvent:f.type==="touch",originalEvent:h.originalEvent,userData:c.userData})}function X(c,h,f){var m,_;m=c.getActivePointersListByType(f.type),_=m.getById(f.id),_?f=_:(f.captured=!1,f.insideElementPressed=!1),c.outHandler&&c.outHandler({eventSource:c,pointerType:f.type,position:f.currentPos&&R(f.currentPos,c.element),buttons:m.buttons,pointers:c.getActivePointerCount(),insideElementPressed:f.insideElementPressed,buttonDownAny:m.buttons!==0,isTouchEvent:f.type==="touch",originalEvent:h.originalEvent,userData:c.userData})}function U(c,h,f,m){var _=t[c.hash],H=c.getActivePointersListByType(f.type),I;if(typeof h.originalEvent.buttons!="undefined"?H.buttons=h.originalEvent.buttons:m===0?H.buttons|=1:m===1?H.buttons|=4:m===2?H.buttons|=2:m===3?H.buttons|=8:m===4?H.buttons|=16:m===5&&(H.buttons|=32),m!==0){h.shouldCapture=!1,h.shouldReleaseCapture=!1,c.nonPrimaryPressHandler&&!h.preventGesture&&!h.defaultPrevented&&(h.preventDefault=!0,c.nonPrimaryPressHandler({eventSource:c,pointerType:f.type,position:R(f.currentPos,c.element),button:m,buttons:H.buttons,isTouchEvent:f.type==="touch",originalEvent:h.originalEvent,userData:c.userData}));return}if(I=H.getById(f.id),I)I.insideElementPressed=!0,I.insideElement=!0,I.originalTarget=h.originalEvent.target,I.contactPos=f.currentPos,I.contactTime=f.currentTime,I.lastPos=I.currentPos,I.lastTime=I.currentTime,I.currentPos=f.currentPos,I.currentTime=f.currentTime,f=I;else{e.console.warn("pointerdown event on untracked pointer"),f.captured=!1,f.insideElementPressed=!0,f.insideElement=!0,f.originalTarget=h.originalEvent.target,v(H,f);return}H.addContact(),!h.preventGesture&&!h.defaultPrevented?(h.shouldCapture=!0,h.shouldReleaseCapture=!1,h.preventDefault=!0,(c.dragHandler||c.dragEndHandler||c.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(c,f),H.contacts===1?c.pressHandler&&!h.preventGesture&&c.pressHandler({eventSource:c,pointerType:f.type,position:R(f.contactPos,c.element),buttons:H.buttons,isTouchEvent:f.type==="touch",originalEvent:h.originalEvent,userData:c.userData}):H.contacts===2&&c.pinchHandler&&f.type==="touch"&&(_.pinchGPoints=H.asArray(),_.lastPinchDist=_.currentPinchDist=_.pinchGPoints[0].currentPos.distanceTo(_.pinchGPoints[1].currentPos),_.lastPinchCenter=_.currentPinchCenter=l(_.pinchGPoints[0].currentPos,_.pinchGPoints[1].currentPos))):(h.shouldCapture=!1,h.shouldReleaseCapture=!1)}function ie(c,h,f,m){var _=t[c.hash],H=c.getActivePointersListByType(f.type),I,Q,W,oe=!1,re;if(typeof h.originalEvent.buttons!="undefined"?H.buttons=h.originalEvent.buttons:m===0?H.buttons^=-2:m===1?H.buttons^=-5:m===2?H.buttons^=-3:m===3?H.buttons^=-9:m===4?H.buttons^=-17:m===5&&(H.buttons^=-33),h.shouldCapture=!1,m!==0){h.shouldReleaseCapture=!1,c.nonPrimaryReleaseHandler&&!h.preventGesture&&!h.defaultPrevented&&(h.preventDefault=!0,c.nonPrimaryReleaseHandler({eventSource:c,pointerType:f.type,position:R(f.currentPos,c.element),button:m,buttons:H.buttons,isTouchEvent:f.type==="touch",originalEvent:h.originalEvent,userData:c.userData}));return}W=H.getById(f.id),W?(H.removeContact(),W.captured&&(oe=!0),W.lastPos=W.currentPos,W.lastTime=W.currentTime,W.currentPos=f.currentPos,W.currentTime=f.currentTime,W.insideElement||C(c,H,W),I=W.currentPos,Q=W.currentTime):(e.console.warn("updatePointerUp(): pointerup on untracked gPoint"),f.captured=!1,f.insideElementPressed=!1,f.insideElement=!0,v(H,f),W=f),!h.preventGesture&&!h.defaultPrevented&&(oe?(h.shouldReleaseCapture=!0,h.preventDefault=!0,(c.dragHandler||c.dragEndHandler||c.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(c,W),H.contacts===0?(c.releaseHandler&&c.releaseHandler({eventSource:c,pointerType:W.type,position:R(I,c.element),buttons:H.buttons,insideElementPressed:W.insideElementPressed,insideElementReleased:W.insideElement,isTouchEvent:W.type==="touch",originalEvent:h.originalEvent,userData:c.userData}),c.dragEndHandler&&_.sentDragEvent&&c.dragEndHandler({eventSource:c,pointerType:W.type,position:R(W.currentPos,c.element),speed:W.speed,direction:W.direction,shift:h.originalEvent.shiftKey,isTouchEvent:W.type==="touch",originalEvent:h.originalEvent,userData:c.userData}),_.sentDragEvent=!1,(c.clickHandler||c.dblClickHandler)&&W.insideElement&&(re=Q-W.contactTime<=c.clickTimeThreshold&&W.contactPos.distanceTo(I)<=c.clickDistThreshold,c.clickHandler&&c.clickHandler({eventSource:c,pointerType:W.type,position:R(W.currentPos,c.element),quick:re,shift:h.originalEvent.shiftKey,isTouchEvent:W.type==="touch",originalEvent:h.originalEvent,originalTarget:W.originalTarget,userData:c.userData}),c.dblClickHandler&&re&&(H.clicks++,H.clicks===1?(_.lastClickPos=I,_.dblClickTimeOut=setTimeout(function(){H.clicks=0},c.dblClickTimeThreshold)):H.clicks===2&&(clearTimeout(_.dblClickTimeOut),H.clicks=0,_.lastClickPos.distanceTo(I)<=c.dblClickDistThreshold&&c.dblClickHandler({eventSource:c,pointerType:W.type,position:R(W.currentPos,c.element),shift:h.originalEvent.shiftKey,isTouchEvent:W.type==="touch",originalEvent:h.originalEvent,userData:c.userData}),_.lastClickPos=null)))):H.contacts===2&&c.pinchHandler&&W.type==="touch"&&(_.pinchGPoints=H.asArray(),_.lastPinchDist=_.currentPinchDist=_.pinchGPoints[0].currentPos.distanceTo(_.pinchGPoints[1].currentPos),_.lastPinchCenter=_.currentPinchCenter=l(_.pinchGPoints[0].currentPos,_.pinchGPoints[1].currentPos))):(h.shouldReleaseCapture=!1,c.releaseHandler&&(c.releaseHandler({eventSource:c,pointerType:W.type,position:R(I,c.element),buttons:H.buttons,insideElementPressed:W.insideElementPressed,insideElementReleased:W.insideElement,isTouchEvent:W.type==="touch",originalEvent:h.originalEvent,userData:c.userData}),h.preventDefault=!0)))}function Z(c,h,f){var m=t[c.hash],_=c.getActivePointersListByType(f.type),H,I,Q;if(typeof h.originalEvent.buttons!="undefined"&&(_.buttons=h.originalEvent.buttons),H=_.getById(f.id),H)H.lastPos=H.currentPos,H.lastTime=H.currentTime,H.currentPos=f.currentPos,H.currentTime=f.currentTime;else return;h.shouldCapture=!1,h.shouldReleaseCapture=!1,c.stopHandler&&f.type==="mouse"&&(clearTimeout(c.stopTimeOut),c.stopTimeOut=setTimeout(function(){le(c,h.originalEvent,f.type)},c.stopDelay)),_.contacts===0?c.moveHandler&&c.moveHandler({eventSource:c,pointerType:f.type,position:R(f.currentPos,c.element),buttons:_.buttons,isTouchEvent:f.type==="touch",originalEvent:h.originalEvent,userData:c.userData}):_.contacts===1?(c.moveHandler&&(H=_.asArray()[0],c.moveHandler({eventSource:c,pointerType:H.type,position:R(H.currentPos,c.element),buttons:_.buttons,isTouchEvent:H.type==="touch",originalEvent:h.originalEvent,userData:c.userData})),c.dragHandler&&!h.preventGesture&&!h.defaultPrevented&&(H=_.asArray()[0],Q=H.currentPos.minus(H.lastPos),c.dragHandler({eventSource:c,pointerType:H.type,position:R(H.currentPos,c.element),buttons:_.buttons,delta:Q,speed:H.speed,direction:H.direction,shift:h.originalEvent.shiftKey,isTouchEvent:H.type==="touch",originalEvent:h.originalEvent,userData:c.userData}),h.preventDefault=!0,m.sentDragEvent=!0)):_.contacts===2&&(c.moveHandler&&(I=_.asArray(),c.moveHandler({eventSource:c,pointerType:I[0].type,position:R(l(I[0].currentPos,I[1].currentPos),c.element),buttons:_.buttons,isTouchEvent:I[0].type==="touch",originalEvent:h.originalEvent,userData:c.userData})),c.pinchHandler&&f.type==="touch"&&!h.preventGesture&&!h.defaultPrevented&&(Q=m.pinchGPoints[0].currentPos.distanceTo(m.pinchGPoints[1].currentPos),Q!==m.currentPinchDist&&(m.lastPinchDist=m.currentPinchDist,m.currentPinchDist=Q,m.lastPinchCenter=m.currentPinchCenter,m.currentPinchCenter=l(m.pinchGPoints[0].currentPos,m.pinchGPoints[1].currentPos),c.pinchHandler({eventSource:c,pointerType:"touch",gesturePoints:m.pinchGPoints,lastCenter:R(m.lastPinchCenter,c.element),center:R(m.currentPinchCenter,c.element),lastDistance:m.lastPinchDist,distance:m.currentPinchDist,shift:h.originalEvent.shiftKey,originalEvent:h.originalEvent,userData:c.userData}),h.preventDefault=!0)))}function se(c,h,f){var m=c.getActivePointersListByType(f.type),_;_=m.getById(f.id),_&&C(c,m,_)}function le(c,h,f){c.stopHandler&&c.stopHandler({eventSource:c,pointerType:f,position:x(h,c.element),buttons:c.getActivePointersListByType(f).buttons,isTouchEvent:f==="touch",originalEvent:h,userData:c.userData})}}(A),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,i,n){var u=t.parentNode;typeof i=="number"&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=typeof i.attachToViewer=="undefined"?!0:i.attachToViewer,this.autoFade=typeof i.autoFade=="undefined"?!0:i.autoFade,this.element=t,this.anchor=i.anchor,this.container=n,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof i.top=="number"?i.top+"px":i.top,this.wrapper.style.left=typeof i.left=="number"?i.left+"px":i.left,this.wrapper.style.height=typeof i.height=="number"?i.height+"px":i.height,this.wrapper.style.width=typeof i.width=="number"?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):u.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(t){this.wrapper.style.display=t?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor===e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(A),function(e){e.ControlDock=function(i){var n=["topleft","topright","bottomright","bottomleft"],u,a;for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(Math.random()*1e6),container:e.makeNeutralElement("div"),controls:[]},i),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),a=0;a<n.length;a++)u=n[a],this.controls[u]=e.makeNeutralElement("div"),this.controls[u].style.position="absolute",u.match("left")&&(this.controls[u].style.left="0px"),u.match("right")&&(this.controls[u].style.right="0px"),u.match("top")&&(this.controls[u].style.top="0px"),u.match("bottom")&&(this.controls[u].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,n){i=e.getElement(i);var u=null;if(!(t(this,i)>=0)){switch(n.anchor){case e.ControlAnchor.TOP_RIGHT:u=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:u=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:u=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:u=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:u=this.container,i.style.margin="0px",i.style.padding="0px";break;default:case e.ControlAnchor.NONE:u=this.container,i.style.margin="0px",i.style.padding="0px";break}this.controls.push(new e.Control(i,n,u)),i.style.display="inline-block"}},removeControl:function(i){i=e.getElement(i);var n=t(this,i);return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var i;for(i=this.controls.length-1;i>=0;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(i){var n;for(n=this.controls.length-1;n>=0;n--)this.controls[n].setVisible(i);return this}};function t(i,n){var u=i.controls,a;for(a=u.length-1;a>=0;a--)if(u[a].element===n)return a;return-1}}(A),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(A),function(e){var t={},i=1;e.Viewer=function(o){var v=arguments,C=this,B;if(e.isPlainObject(o)||(o={id:v[0],xmlPath:v.length>1?v[1]:void 0,prefixUrl:v.length>2?v[2]:void 0,controls:v.length>3?v[3]:void 0,overlays:v.length>4?v[4]:void 0}),o.config&&(e.extend(!0,o,o.config),delete o.config),e.extend(!0,this,{id:o.id,hash:o.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,o),typeof this.hash=="undefined")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof t[this.hash]!="undefined"&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(D){var k=e.getString("Errors.OpenFailed",D.eventSource,D.message);C._showMessage(k)}),e.ControlDock.call(this,o),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(D){D.width="100%",D.height="100%",D.overflow="hidden",D.position="absolute",D.top="0px",D.left="0px"}(this.canvas.style),e.setElementTouchActionNone(this.canvas),o.tabIndex!==""&&(this.canvas.tabIndex=o.tabIndex===void 0?0:o.tabIndex),this.container.className="openseadragon-container",function(D){D.width="100%",D.height="100%",D.position="relative",D.overflow="hidden",D.left="0px",D.top="0px",D.textAlign="left"}(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,x),keyDownHandler:e.delegate(this,R),keyHandler:e.delegate(this,l),clickHandler:e.delegate(this,y),dblClickHandler:e.delegate(this,E),dragHandler:e.delegate(this,S),dragEndHandler:e.delegate(this,b),enterHandler:e.delegate(this,O),leaveHandler:e.delegate(this,L),pressHandler:e.delegate(this,F),releaseHandler:e.delegate(this,G),nonPrimaryPressHandler:e.delegate(this,V),nonPrimaryReleaseHandler:e.delegate(this,N),scrollHandler:e.delegate(this,j),pinchHandler:e.delegate(this,q)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,J),leaveHandler:e.delegate(this,K)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=n(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(D){C.source=C.world.getItemAt(0).source,t[C.hash].forceRedraw=!0,C._updateRequestId||(C._updateRequestId=s(C,te))}),this.world.addHandler("remove-item",function(D){C.world.getItemCount()?C.source=C.world.getItemAt(0).source:C.source=null,t[C.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(D){C.viewport&&C.viewport._setContentBounds(C.world.getHomeBounds(),C.world.getContentFactor())}),this.world.addHandler("item-index-change",function(D){C.source=C.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:o.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(B=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(B,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(B=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(B,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),B=0;B<this.customControls.length;B++)this.addControl(this.customControls[B].id,{anchor:this.customControls[B].anchor});e.requestAnimationFrame(function(){g(C)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(o){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(o)},openTileSource:function(o){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(o)},open:function(o,v){var C=this;if(this.close(),!o)return this;if(this.sequenceMode&&e.isArray(o))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof v!="undefined"&&!isNaN(v)&&(this.initialPage=v),this.tileSources=o,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(e.isArray(o)||(o=[o]),!o.length)return this;this._opening=!0;for(var B=o.length,D=0,k=0,z,Y=function(){if(D+k===B)if(D){(C._firstOpen||!C.preserveViewport)&&(C.viewport.goHome(!0),C.viewport.update()),C._firstOpen=!1;var U=o[0];if(U.tileSource&&(U=U.tileSource),C.overlays&&!C.preserveOverlays)for(var ie=0;ie<C.overlays.length;ie++)C.currentOverlays[ie]=a(C,C.overlays[ie]);C._drawOverlays(),C._opening=!1,C.raiseEvent("open",{source:U})}else C._opening=!1,C.raiseEvent("open-failed",z)},ee=function(U){(!e.isPlainObject(U)||!U.tileSource)&&(U={tileSource:U}),U.index!==void 0&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete U.index),U.collectionImmediately===void 0&&(U.collectionImmediately=!0);var ie=U.success;U.success=function(se){if(D++,U.tileSource.overlays)for(var le=0;le<U.tileSource.overlays.length;le++)C.addOverlay(U.tileSource.overlays[le]);ie&&ie(se),Y()};var Z=U.error;U.error=function(se){k++,z||(z=se),Z&&Z(se),Y()},C.addTiledImage(U)},X=0;X<o.length;X++)ee(o[X]);return this},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(!!t[this.hash]){if(this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),t[this.navigator.hash]=null,delete t[this.navigator.hash],this.navigator=null),this.removeAllHandlers(),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(o){return this.innerTracker.setTracking(o),this.outerTracker.setTracking(o),this.raiseEvent("mouse-enabled",{enabled:o}),this},areControlsEnabled:function(){var o=this.controls.length,v;for(v=0;v<this.controls.length;v++)o=o&&this.controls[v].isVisible();return o},setControlsEnabled:function(o){return o?w(this):g(this),this.raiseEvent("controls-enabled",{enabled:o}),this},setDebugMode:function(o){for(var v=0;v<this.world.getItemCount();v++)this.world.getItemAt(v).debugMode=o;this.debugMode=o,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(o){var v=document.body,C=v.style,B=document.documentElement.style,D=this,k,z;if(o===this.isFullPage())return this;var Y={fullPage:o,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",Y),Y.preventDefaultAction)return this;if(o){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=C.margin,this.docMargin=B.margin,C.margin="0",B.margin="0",this.bodyPadding=C.padding,this.docPadding=B.padding,C.padding="0",B.padding="0",this.bodyWidth=C.width,this.docWidth=B.width,C.width="100%",B.width="100%",this.bodyHeight=C.height,this.docHeight=B.height,C.height="100%",B.height="100%",this.bodyDisplay=C.display,C.display="block",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,k=v.childNodes.length,z=0;z<k;z++)this.previousBody.push(v.childNodes[0]),v.removeChild(v.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,v.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),v.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,J)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,C.margin=this.bodyMargin,B.margin=this.docMargin,C.padding=this.bodyPadding,B.padding=this.docPadding,C.width=this.bodyWidth,B.width=this.docWidth,C.height=this.bodyHeight,B.height=this.docHeight,C.display=this.bodyDisplay,v.removeChild(this.element),k=this.previousBody.length,z=0;z<k;z++)v.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(v.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var ee=0,X=function(){e.setPageScroll(D.pageScroll);var U=e.getPageScroll();ee++,ee<10&&(U.x!==D.pageScroll.x||U.y!==D.pageScroll.y)&&e.requestAnimationFrame(X)};e.requestAnimationFrame(X),t[this.hash].fullPage=!1,e.delegate(this,K)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:o}),this},setFullScreen:function(o){var v=this;if(!e.supportsFullScreen)return this.setFullPage(o);if(e.isFullScreen()===o)return this;var C={fullScreen:o,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",C),C.preventDefaultAction)return this;if(o){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var B=function(){var D=e.isFullScreen();D||(e.removeEvent(document,e.fullScreenEventName,B),e.removeEvent(document,e.fullScreenErrorEventName,B),v.setFullPage(!1),v.isFullPage()&&(v.element.style.width=v.fullPageStyleWidth,v.element.style.height=v.fullPageStyleHeight)),v.navigator&&v.viewport&&setTimeout(function(){v.navigator.update(v.viewport)}),v.raiseEvent("full-screen",{fullScreen:D})};e.addEvent(document,e.fullScreenEventName,B),e.addEvent(document,e.fullScreenErrorEventName,B),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},setVisible:function(o){return this.container.style.visibility=o?"":"hidden",this.raiseEvent("visible",{visible:o}),this},addTiledImage:function(o){e.console.assert(o,"[Viewer.addTiledImage] options is required"),e.console.assert(o.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!o.replace||o.index>-1&&o.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var v=this;o.replace&&(o.replaceItem=v.world.getItemAt(o.index)),this._hideMessage(),o.placeholderFillStyle===void 0&&(o.placeholderFillStyle=this.placeholderFillStyle),o.opacity===void 0&&(o.opacity=this.opacity),o.preload===void 0&&(o.preload=this.preload),o.compositeOperation===void 0&&(o.compositeOperation=this.compositeOperation),o.crossOriginPolicy===void 0&&(o.crossOriginPolicy=o.tileSource.crossOriginPolicy!==void 0?o.tileSource.crossOriginPolicy:this.crossOriginPolicy),o.ajaxWithCredentials===void 0&&(o.ajaxWithCredentials=this.ajaxWithCredentials),o.loadTilesWithAjax===void 0&&(o.loadTilesWithAjax=this.loadTilesWithAjax),o.ajaxHeaders===void 0||o.ajaxHeaders===null?o.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(o.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(o.ajaxHeaders=e.extend({},this.ajaxHeaders,o.ajaxHeaders));var C={options:o};function B(z){for(var Y=0;Y<v._loadQueue.length;Y++)if(v._loadQueue[Y]===C){v._loadQueue.splice(Y,1);break}v._loadQueue.length===0&&D(C),v.raiseEvent("add-item-failed",z),o.error&&o.error(z)}function D(z){v.collectionMode&&(v.world.arrange({immediately:z.options.collectionImmediately,rows:v.collectionRows,columns:v.collectionColumns,layout:v.collectionLayout,tileSize:v.collectionTileSize,tileMargin:v.collectionTileMargin}),v.world.setAutoRefigureSizes(!0))}if(e.isArray(o.tileSource)){setTimeout(function(){B({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:o.tileSource,options:o})});return}this._loadQueue.push(C);function k(){for(var z,Y,ee;v._loadQueue.length&&(z=v._loadQueue[0],!!z.tileSource);){if(v._loadQueue.splice(0,1),z.options.replace){var X=v.world.getIndexOfItem(z.options.replaceItem);X!==-1&&(z.options.index=X),v.world.removeItem(z.options.replaceItem)}Y=new e.TiledImage({viewer:v,source:z.tileSource,viewport:v.viewport,drawer:v.drawer,tileCache:v.tileCache,imageLoader:v.imageLoader,x:z.options.x,y:z.options.y,width:z.options.width,height:z.options.height,fitBounds:z.options.fitBounds,fitBoundsPlacement:z.options.fitBoundsPlacement,clip:z.options.clip,placeholderFillStyle:z.options.placeholderFillStyle,opacity:z.options.opacity,preload:z.options.preload,degrees:z.options.degrees,flipped:z.options.flipped,compositeOperation:z.options.compositeOperation,springStiffness:v.springStiffness,animationTime:v.animationTime,minZoomImageRatio:v.minZoomImageRatio,wrapHorizontal:v.wrapHorizontal,wrapVertical:v.wrapVertical,immediateRender:v.immediateRender,blendTime:v.blendTime,alwaysBlend:v.alwaysBlend,minPixelRatio:v.minPixelRatio,smoothTileEdgesMinZoom:v.smoothTileEdgesMinZoom,iOSDevice:v.iOSDevice,crossOriginPolicy:z.options.crossOriginPolicy,ajaxWithCredentials:z.options.ajaxWithCredentials,loadTilesWithAjax:z.options.loadTilesWithAjax,ajaxHeaders:z.options.ajaxHeaders,debugMode:v.debugMode}),v.collectionMode&&v.world.setAutoRefigureSizes(!1),v.navigator&&(ee=e.extend({},z.options,{replace:!1,originalTiledImage:Y,tileSource:z.tileSource}),v.navigator.addTiledImage(ee)),v.world.addItem(Y,{index:z.options.index}),v._loadQueue.length===0&&D(z),v.world.getItemCount()===1&&!v.preserveViewport&&v.viewport.goHome(!0),z.options.success&&z.options.success({item:Y})}}u(this,o.tileSource,o,function(z){C.tileSource=z,k()},function(z){z.options=o,B(z),k()})},addSimpleImage:function(o){e.console.assert(o,"[Viewer.addSimpleImage] options is required"),e.console.assert(o.url,"[Viewer.addSimpleImage] options.url is required");var v=e.extend({},o,{tileSource:{type:"image",url:o.url}});delete v.url,this.addTiledImage(v)},addLayer:function(o){var v=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var C=e.extend({},o,{success:function(B){v.raiseEvent("add-layer",{options:o,drawer:B.item})},error:function(B){v.raiseEvent("add-layer-failed",B)}});return this.addTiledImage(C),this},getLayerAtLevel:function(o){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(o)},getLevelOfLayer:function(o){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(o)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(o,v){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(o,v)},removeLayer:function(o){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(o)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var o=e.delegate(this,T),v=e.delegate(this,P),C=e.delegate(this,this.goToNextPage),B=e.delegate(this,this.goToPreviousPage),D=this.navImages,k=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(k=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:M(this.prefixUrl,D.previous.REST),srcGroup:M(this.prefixUrl,D.previous.GROUP),srcHover:M(this.prefixUrl,D.previous.HOVER),srcDown:M(this.prefixUrl,D.previous.DOWN),onRelease:B,onFocus:o,onBlur:v}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:M(this.prefixUrl,D.next.REST),srcGroup:M(this.prefixUrl,D.next.GROUP),srcHover:M(this.prefixUrl,D.next.HOVER),srcDown:M(this.prefixUrl,D.next.DOWN),onRelease:C,onFocus:o,onBlur:v}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),k&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var o=e.delegate(this,ae),v=e.delegate(this,de),C=e.delegate(this,pe),B=e.delegate(this,Te),D=e.delegate(this,ge),k=e.delegate(this,xe),z=e.delegate(this,ve),Y=e.delegate(this,ye),ee=e.delegate(this,Ee),X=e.delegate(this,we),U=e.delegate(this,T),ie=e.delegate(this,P),Z=this.navImages,se=[],le=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(le=!1),this.showZoomControl&&(se.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:M(this.prefixUrl,Z.zoomIn.REST),srcGroup:M(this.prefixUrl,Z.zoomIn.GROUP),srcHover:M(this.prefixUrl,Z.zoomIn.HOVER),srcDown:M(this.prefixUrl,Z.zoomIn.DOWN),onPress:o,onRelease:v,onClick:C,onEnter:o,onExit:v,onFocus:U,onBlur:ie})),se.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:M(this.prefixUrl,Z.zoomOut.REST),srcGroup:M(this.prefixUrl,Z.zoomOut.GROUP),srcHover:M(this.prefixUrl,Z.zoomOut.HOVER),srcDown:M(this.prefixUrl,Z.zoomOut.DOWN),onPress:B,onRelease:v,onClick:D,onEnter:B,onExit:v,onFocus:U,onBlur:ie}))),this.showHomeControl&&se.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:M(this.prefixUrl,Z.home.REST),srcGroup:M(this.prefixUrl,Z.home.GROUP),srcHover:M(this.prefixUrl,Z.home.HOVER),srcDown:M(this.prefixUrl,Z.home.DOWN),onRelease:k,onFocus:U,onBlur:ie})),this.showFullPageControl&&se.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:M(this.prefixUrl,Z.fullpage.REST),srcGroup:M(this.prefixUrl,Z.fullpage.GROUP),srcHover:M(this.prefixUrl,Z.fullpage.HOVER),srcDown:M(this.prefixUrl,Z.fullpage.DOWN),onRelease:z,onFocus:U,onBlur:ie})),this.showRotationControl&&(se.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:M(this.prefixUrl,Z.rotateleft.REST),srcGroup:M(this.prefixUrl,Z.rotateleft.GROUP),srcHover:M(this.prefixUrl,Z.rotateleft.HOVER),srcDown:M(this.prefixUrl,Z.rotateleft.DOWN),onRelease:Y,onFocus:U,onBlur:ie})),se.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:M(this.prefixUrl,Z.rotateright.REST),srcGroup:M(this.prefixUrl,Z.rotateright.GROUP),srcHover:M(this.prefixUrl,Z.rotateright.HOVER),srcDown:M(this.prefixUrl,Z.rotateright.DOWN),onRelease:ee,onFocus:U,onBlur:ie}))),this.showFlipControl&&se.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:M(this.prefixUrl,Z.flip.REST),srcGroup:M(this.prefixUrl,Z.flip.GROUP),srcHover:M(this.prefixUrl,Z.flip.HOVER),srcDown:M(this.prefixUrl,Z.flip.DOWN),onRelease:X,onFocus:U,onBlur:ie})),le?(this.buttonGroup=new e.ButtonGroup({buttons:se,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,me)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=se),this},currentPage:function(){return this._sequenceIndex},goToPage:function(o){return this.tileSources&&o>=0&&o<this.tileSources.length&&(this._sequenceIndex=o,this._updateSequenceButtons(o),this.open(this.tileSources[o]),this.referenceStrip&&this.referenceStrip.setFocus(o),this.raiseEvent("page",{page:o})),this},addOverlay:function(o,v,C,B){var D;if(e.isPlainObject(o)?D=o:D={element:o,location:v,placement:C,onDraw:B},o=e.getElement(D.element),r(this.currentOverlays,o)>=0)return this;var k=a(this,D);return this.currentOverlays.push(k),k.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:o,location:D.location,placement:D.placement}),this},updateOverlay:function(o,v,C){var B;return o=e.getElement(o),B=r(this.currentOverlays,o),B>=0&&(this.currentOverlays[B].update(v,C),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:o,location:v,placement:C})),this},removeOverlay:function(o){var v;return o=e.getElement(o),v=r(this.currentOverlays,o),v>=0&&(this.currentOverlays[v].destroy(),this.currentOverlays.splice(v,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:o})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(o){var v;return o=e.getElement(o),v=r(this.currentOverlays,o),v>=0?this.currentOverlays[v]:null},_updateSequenceButtons:function(o){this.nextButton&&(!this.tileSources||this.tileSources.length-1===o?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(o>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(o){this._hideMessage();var v=e.makeNeutralElement("div");v.appendChild(document.createTextNode(o)),this.messageDiv=e.makeCenteredNode(v),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var o=this.messageDiv;o&&(o.parentNode.removeChild(o),delete this.messageDiv)},gestureSettingsByDeviceType:function(o){switch(o){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var o,v=this.currentOverlays.length;for(o=0;o<v;o++)this.currentOverlays[o].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var o=e.pixelDensityRatio,v=e.getCurrentPixelDensityRatio();o!==v&&(e.pixelDensityRatio=v,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var o=this._sequenceIndex-1;this.navPrevNextWrap&&o<0&&(o+=this.tileSources.length),this.goToPage(o)},goToNextPage:function(){var o=this._sequenceIndex+1;this.navPrevNextWrap&&o>=this.tileSources.length&&(o=0),this.goToPage(o)}});function n(o){return o=e.getElement(o),new e.Point(o.clientWidth===0?1:o.clientWidth,o.clientHeight===0?1:o.clientHeight)}function u(o,v,C,B,D){var k=o;if(e.type(v)==="string"){if(v.match(/^\s*<.*>\s*$/))v=e.parseXml(v);else if(v.match(/^\s*[{[].*[}\]]\s*$/))try{var z=e.parseJSON(v);v=z}catch{}}function Y(ee,X){ee.ready?B(ee):(ee.addHandler("ready",function(){B(ee)}),ee.addHandler("open-failed",function(U){D({message:U.message,source:X})}))}setTimeout(function(){if(e.type(v)==="string")v=new e.TileSource({url:v,crossOriginPolicy:C.crossOriginPolicy!==void 0?C.crossOriginPolicy:o.crossOriginPolicy,ajaxWithCredentials:o.ajaxWithCredentials,ajaxHeaders:C.ajaxHeaders?C.ajaxHeaders:o.ajaxHeaders,useCanvas:o.useCanvas,success:function(ie){B(ie.tileSource)}}),v.addHandler("open-failed",function(ie){D(ie)});else if(e.isPlainObject(v)||v.nodeType)if(v.crossOriginPolicy===void 0&&(C.crossOriginPolicy!==void 0||o.crossOriginPolicy!==void 0)&&(v.crossOriginPolicy=C.crossOriginPolicy!==void 0?C.crossOriginPolicy:o.crossOriginPolicy),v.ajaxWithCredentials===void 0&&(v.ajaxWithCredentials=o.ajaxWithCredentials),v.useCanvas===void 0&&(v.useCanvas=o.useCanvas),e.isFunction(v.getTileUrl)){var ee=new e.TileSource(v);ee.getTileUrl=v.getTileUrl,B(ee)}else{var X=e.TileSource.determineType(k,v);if(!X){D({message:"Unable to load TileSource",source:v});return}var U=X.prototype.configure.apply(k,[v]);Y(new X(U),v)}else Y(v,v)})}function a(o,v){if(v instanceof e.Overlay)return v;var C=null;if(v.element)C=e.getElement(v.element);else{var B=v.id?v.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);C=e.getElement(v.id),C||(C=document.createElement("a"),C.href="#/overlay/"+B),C.id=B,e.addClass(C,v.className?v.className:"openseadragon-overlay")}var D=v.location,k=v.width,z=v.height;if(!D){var Y=v.x,ee=v.y;if(v.px!==void 0){var X=o.viewport.imageToViewportRectangle(new e.Rect(v.px,v.py,k||0,z||0));Y=X.x,ee=X.y,k=k!==void 0?X.width:void 0,z=z!==void 0?X.height:void 0}D=new e.Point(Y,ee)}var U=v.placement;return U&&e.type(U)==="string"&&(U=e.Placement[v.placement.toUpperCase()]),new e.Overlay({element:C,location:D,placement:U,onDraw:v.onDraw,checkResize:v.checkResize,width:k,height:z,rotationMode:v.rotationMode})}function r(o,v){var C;for(C=o.length-1;C>=0;C--)if(o[C].element===v)return C;return-1}function s(o,v){return e.requestAnimationFrame(function(){v(o)})}function d(o){e.requestAnimationFrame(function(){p(o)})}function g(o){!o.autoHideControls||(o.controlsShouldFade=!0,o.controlsFadeBeginTime=e.now()+o.controlsFadeDelay,window.setTimeout(function(){d(o)},o.controlsFadeDelay))}function p(o){var v,C,B,D;if(o.controlsShouldFade){for(v=e.now(),C=v-o.controlsFadeBeginTime,B=1-C/o.controlsFadeLength,B=Math.min(1,B),B=Math.max(0,B),D=o.controls.length-1;D>=0;D--)o.controls[D].autoFade&&o.controls[D].setOpacity(B);B>0&&d(o)}}function w(o){var v;for(o.controlsShouldFade=!1,v=o.controls.length-1;v>=0;v--)o.controls[v].setOpacity(1)}function T(){w(this)}function P(){g(this)}function x(o){var v={tracker:o.eventSource,position:o.position,originalEvent:o.originalEvent,preventDefault:o.preventDefault};this.raiseEvent("canvas-contextmenu",v),o.preventDefault=v.preventDefault}function R(o){var v={originalEvent:o.originalEvent,preventDefaultAction:!1,preventVerticalPan:o.preventVerticalPan,preventHorizontalPan:o.preventHorizontalPan};if(this.raiseEvent("canvas-key",v),!v.preventDefaultAction&&!o.ctrl&&!o.alt&&!o.meta)switch(o.keyCode){case 38:v.preventVerticalPan||(o.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 40:v.preventVerticalPan||(o.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 37:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 39:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;default:o.preventDefault=!1;break}else o.preventDefault=!1}function l(o){var v={originalEvent:o.originalEvent,preventDefaultAction:!1,preventVerticalPan:o.preventVerticalPan,preventHorizontalPan:o.preventHorizontalPan};if(this.raiseEvent("canvas-key",v),!v.preventDefaultAction&&!o.ctrl&&!o.alt&&!o.meta)switch(o.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 119:case 87:v.preventVerticalPan||(o.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 115:case 83:v.preventVerticalPan||(o.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 97:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 100:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),o.preventDefault=!0;break;case 114:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 82:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),o.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),o.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:o.preventDefault=!1;break}else o.preventDefault=!1}function y(o){var v,C=document.activeElement===this.canvas;C||this.canvas.focus(),this.viewport.flipped&&(o.position.x=this.viewport.getContainerSize().x-o.position.x);var B={tracker:o.eventSource,position:o.position,quick:o.quick,shift:o.shift,originalEvent:o.originalEvent,originalTarget:o.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",B),!B.preventDefaultAction&&this.viewport&&o.quick&&(v=this.gestureSettingsByDeviceType(o.pointerType),v.clickToZoom&&(this.viewport.zoomBy(o.shift?1/this.zoomPerClick:this.zoomPerClick,v.zoomToRefPoint?this.viewport.pointFromPixel(o.position,!0):null),this.viewport.applyConstraints()))}function E(o){var v,C={tracker:o.eventSource,position:o.position,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",C),!C.preventDefaultAction&&this.viewport&&(v=this.gestureSettingsByDeviceType(o.pointerType),v.dblClickToZoom&&(this.viewport.zoomBy(o.shift?1/this.zoomPerClick:this.zoomPerClick,v.zoomToRefPoint?this.viewport.pointFromPixel(o.position,!0):null),this.viewport.applyConstraints()))}function S(o){var v,C={tracker:o.eventSource,pointerType:o.pointerType,position:o.position,delta:o.delta,speed:o.speed,direction:o.direction,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",C),v=this.gestureSettingsByDeviceType(o.pointerType),v.dragToPan&&!C.preventDefaultAction&&this.viewport){if(this.panHorizontal||(o.delta.x=0),this.panVertical||(o.delta.y=0),this.viewport.flipped&&(o.delta.x=-o.delta.x),this.constrainDuringPan){var B=this.viewport.deltaPointsFromPixels(o.delta.negate());this.viewport.centerSpringX.target.value+=B.x,this.viewport.centerSpringY.target.value+=B.y;var D=this.viewport.getBounds(),k=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=B.x,this.viewport.centerSpringY.target.value-=B.y,D.x!==k.x&&(o.delta.x=0),D.y!==k.y&&(o.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(o.delta.negate()),v.flickEnabled&&!this.constrainDuringPan)}}function b(o){var v={tracker:o.eventSource,pointerType:o.pointerType,position:o.position,speed:o.speed,direction:o.direction,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",v),!v.preventDefaultAction&&this.viewport){var C=this.gestureSettingsByDeviceType(o.pointerType);if(C.flickEnabled&&o.speed>=C.flickMinSpeed){var B=0;this.panHorizontal&&(B=C.flickMomentum*o.speed*Math.cos(o.direction));var D=0;this.panVertical&&(D=C.flickMomentum*o.speed*Math.sin(o.direction));var k=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),z=this.viewport.pointFromPixel(new e.Point(k.x-B,k.y-D));this.viewport.panTo(z,!1)}this.viewport.applyConstraints()}}function O(o){this.raiseEvent("canvas-enter",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function L(o){this.raiseEvent("canvas-exit",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function F(o){this.raiseEvent("canvas-press",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,insideElementPressed:o.insideElementPressed,insideElementReleased:o.insideElementReleased,originalEvent:o.originalEvent})}function G(o){this.raiseEvent("canvas-release",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,insideElementPressed:o.insideElementPressed,insideElementReleased:o.insideElementReleased,originalEvent:o.originalEvent})}function V(o){this.raiseEvent("canvas-nonprimary-press",{tracker:o.eventSource,position:o.position,pointerType:o.pointerType,button:o.button,buttons:o.buttons,originalEvent:o.originalEvent})}function N(o){this.raiseEvent("canvas-nonprimary-release",{tracker:o.eventSource,position:o.position,pointerType:o.pointerType,button:o.button,buttons:o.buttons,originalEvent:o.originalEvent})}function q(o){var v,C,B,D,k={tracker:o.eventSource,pointerType:o.pointerType,gesturePoints:o.gesturePoints,lastCenter:o.lastCenter,center:o.center,lastDistance:o.lastDistance,distance:o.distance,shift:o.shift,originalEvent:o.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",k),this.viewport&&(v=this.gestureSettingsByDeviceType(o.pointerType),v.pinchToZoom&&(!k.preventDefaultPanAction||!k.preventDefaultZoomAction)&&(C=this.viewport.pointFromPixel(o.center,!0),k.preventDefaultZoomAction||this.viewport.zoomBy(o.distance/o.lastDistance,C,!0),v.zoomToRefPoint&&!k.preventDefaultPanAction&&(B=this.viewport.pointFromPixel(o.lastCenter,!0),D=B.minus(C),this.panHorizontal||(D.x=0),this.panVertical||(D.y=0),this.viewport.panBy(D,!0)),this.viewport.applyConstraints()),v.pinchRotate&&!k.preventDefaultRotateAction)){var z=Math.atan2(o.gesturePoints[0].currentPos.y-o.gesturePoints[1].currentPos.y,o.gesturePoints[0].currentPos.x-o.gesturePoints[1].currentPos.x),Y=Math.atan2(o.gesturePoints[0].lastPos.y-o.gesturePoints[1].lastPos.y,o.gesturePoints[0].lastPos.x-o.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(z-Y)*(180/Math.PI))}}function j(o){var v,C,B,D,k;D=e.now(),k=D-this._lastScrollTime,k>this.minScrollDeltaTime?(this._lastScrollTime=D,v={tracker:o.eventSource,position:o.position,scroll:o.scroll,shift:o.shift,originalEvent:o.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",v),!v.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(o.position.x=this.viewport.getContainerSize().x-o.position.x),C=this.gestureSettingsByDeviceType(o.pointerType),C.scrollToZoom&&(B=Math.pow(this.zoomPerScroll,o.scroll),this.viewport.zoomBy(B,C.zoomToRefPoint?this.viewport.pointFromPixel(o.position,!0):null),this.viewport.applyConstraints())),o.preventDefault=v.preventDefault):o.preventDefault=!0}function J(o){t[this.hash].mouseInside=!0,w(this),this.raiseEvent("container-enter",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function K(o){o.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||g(this)),this.raiseEvent("container-exit",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function te(o){$(o),o.isOpen()?o._updateRequestId=s(o,te):o._updateRequestId=!1}function $(o){if(!(o._opening||!t[o.hash])){if(o.autoResize){var v=n(o.container),C=t[o.hash].prevContainerSize;if(!v.equals(C)){var B=o.viewport;if(o.preserveImageSizeOnResize){var D=C.x/v.x,k=B.getZoom()*D,z=B.getCenter();B.resize(v,!1),B.zoomTo(k,null,!0),B.panTo(z,!0)}else{var Y=B.getBounds();B.resize(v,!0),B.fitBoundsWithConstraints(Y,!0)}t[o.hash].prevContainerSize=v,t[o.hash].forceRedraw=!0}}var ee=o.viewport.update(),X=o.world.update()||ee;ee&&o.raiseEvent("viewport-change"),o.referenceStrip&&(X=o.referenceStrip.update(o.viewport)||X),!t[o.hash].animating&&X&&(o.raiseEvent("animation-start"),w(o)),(X||t[o.hash].forceRedraw||o.world.needsDraw())&&(ne(o),o._drawOverlays(),o.navigator&&o.navigator.update(o.viewport),t[o.hash].forceRedraw=!1,X&&o.raiseEvent("animation")),t[o.hash].animating&&!X&&(o.raiseEvent("animation-finish"),t[o.hash].mouseInside||g(o)),t[o.hash].animating=X}}function ne(o){o.imageLoader.clear(),o.drawer.clear(),o.world.draw(),o.raiseEvent("update-viewport",{})}function M(o,v){return o?o+v:v}function ae(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,ue(this)}function Te(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,ue(this)}function de(){t[this.hash].zooming=!1}function ue(o){e.requestAnimationFrame(e.delegate(o,fe))}function fe(){var o,v,C;t[this.hash].zooming&&this.viewport&&(o=e.now(),v=o-t[this.hash].lastZoomTime,C=Math.pow(t[this.hash].zoomFactor,v/1e3),this.viewport.zoomBy(C),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=o,ue(this))}function pe(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function ge(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function me(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function xe(){this.viewport&&this.viewport.goHome()}function ve(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function ye(){if(this.viewport){var o=this.viewport.getRotation();this.viewport.flipped?o=e.positiveModulo(o+this.rotationIncrement,360):o=e.positiveModulo(o-this.rotationIncrement,360),this.viewport.setRotation(o)}}function Ee(){if(this.viewport){var o=this.viewport.getRotation();this.viewport.flipped?o=e.positiveModulo(o-this.rotationIncrement,360):o=e.positiveModulo(o+this.rotationIncrement,360),this.viewport.setRotation(o)}}function we(){this.viewport.toggleFlip()}}(A),function(e){e.Navigator=function(s){var d=s.viewer,g=this,p,w;s.id?(this.element=document.getElementById(s.id),s.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(s.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),s.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:s.autoFade},s.position&&(s.position==="BOTTOM_RIGHT"?s.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:s.position==="BOTTOM_LEFT"?s.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:s.position==="TOP_RIGHT"?s.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:s.position==="TOP_LEFT"?s.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:s.position==="ABSOLUTE"&&(s.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,s.controlOptions.top=s.top,s.controlOptions.left=s.left,s.controlOptions.height=s.height,s.controlOptions.width=s.width))),this.element.id=s.id,this.element.className+=" navigator",s=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},s,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:s.autoResize,minZoomImageRatio:1,background:s.background,opacity:s.opacity,borderColor:s.borderColor,displayRegionColor:s.displayRegionColor}),s.minPixelRatio=this.minPixelRatio=d.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),s.controlOptions.anchor!==e.ControlAnchor.NONE&&function(x,R){x.margin="0px",x.border=R+"px solid "+s.borderColor,x.padding="0px",x.background=s.background,x.opacity=s.opacity,x.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(x,R){x.position="relative",x.top="0px",x.left="0px",x.fontSize="0px",x.overflow="hidden",x.border=R+"px solid "+s.displayRegionColor,x.margin="0px",x.padding="0px",x.background="transparent",x.float="left",x.cssFloat="left",x.styleFloat="left",x.zIndex=999999999,x.cursor="default"}(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),d.addControl(this.element,s.controlOptions),this._resizeWithViewer=s.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&s.controlOptions.anchor!==e.ControlAnchor.NONE,s.width&&s.height?(this.setWidth(s.width),this.setHeight(s.height)):this._resizeWithViewer&&(p=e.getElementSize(d.element),this.element.style.height=Math.round(p.y*s.sizeRatio)+"px",this.element.style.width=Math.round(p.x*s.sizeRatio)+"px",this.oldViewerSize=p,w=e.getElementSize(this.element),this.elementArea=w.x*w.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[s]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function T(x){a(g.displayRegionContainer,x),a(g.displayRegion,-x),g.viewport.setRotation(x)}if(s.navigatorRotate){var P=s.viewer.viewport?s.viewer.viewport.getRotation():s.viewer.degrees||0;T(P),s.viewer.addHandler("rotate",function(x){T(x.degrees)})}this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,n),scrollHandler:e.delegate(this,u),preProcessEventHandler:function(x){x.eventType==="wheel"&&(x.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){g.viewport&&g.viewport.goHome(!0)}),d.world.addHandler("item-index-change",function(x){window.setTimeout(function(){var R=g.world.getItemAt(x.previousIndex);g.world.setItemIndex(R,x.newIndex)},1)}),d.world.addHandler("remove-item",function(x){var R=x.item,l=g._getMatchingItem(R);l&&g.world.removeItem(l)}),this.update(d.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var s=new e.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);s.equals(this.oldContainerSize)||(this.viewport.resize(s,!0),this.viewport.goHome(!0),this.oldContainerSize=s,this.drawer.clear(),this.world.draw())}},setWidth:function(s){this.width=s,this.element.style.width=typeof s=="number"?s+"px":s,this._resizeWithViewer=!1},setHeight:function(s){this.height=s,this.element.style.height=typeof s=="number"?s+"px":s,this._resizeWithViewer=!1},setFlip:function(s){return this.viewport.setFlip(s),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(s){r(this.displayRegion,s),r(this.canvas,s),r(this.element,s)},update:function(s){var d,g,p,w,T,P;if(d=e.getElementSize(this.viewer.element),this._resizeWithViewer&&d.x&&d.y&&!d.equals(this.oldViewerSize)&&(this.oldViewerSize=d,this.maintainSizeRatio||!this.elementArea?(g=d.x*this.sizeRatio,p=d.y*this.sizeRatio):(g=Math.sqrt(this.elementArea*(d.x/d.y)),p=this.elementArea/g),this.element.style.width=Math.round(g)+"px",this.element.style.height=Math.round(p)+"px",this.elementArea||(this.elementArea=g*p),this.updateSize()),s&&this.viewport){w=s.getBoundsNoRotate(!0),T=this.viewport.pixelFromPointNoRotate(w.getTopLeft(),!1),P=this.viewport.pixelFromPointNoRotate(w.getBottomRight(),!1).minus(this.totalBorderWidths);var x=this.displayRegion.style;x.display=this.world.getItemCount()?"block":"none",x.top=Math.round(T.y)+"px",x.left=Math.round(T.x)+"px";var R=Math.abs(T.x-P.x),l=Math.abs(T.y-P.y);x.width=Math.round(Math.max(R,0))+"px",x.height=Math.round(Math.max(l,0))+"px"}},addTiledImage:function(s){var d=this,g=s.originalTiledImage;delete s.original;var p=e.extend({},s,{success:function(w){var T=w.item;T._originalForNavigator=g,d._matchBounds(T,g,!0),d._matchOpacity(T,g),d._matchCompositeOperation(T,g);function P(){d._matchBounds(T,g)}function x(){d._matchOpacity(T,g)}function R(){d._matchCompositeOperation(T,g)}g.addHandler("bounds-change",P),g.addHandler("clip-change",P),g.addHandler("opacity-change",x),g.addHandler("composite-operation-change",R)}});return e.Viewer.prototype.addTiledImage.apply(this,[p])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(s){for(var d=this.world.getItemCount(),g,p=0;p<d;p++)if(g=this.world.getItemAt(p),g._originalForNavigator===s)return g;return null},_matchBounds:function(s,d,g){var p=d.getBoundsNoRotate();s.setPosition(p.getTopLeft(),g),s.setWidth(p.width,g),s.setRotation(d.getRotation(),g),s.setClip(d.getClip()),s.setFlip(d.getFlip())},_matchOpacity:function(s,d){s.setOpacity(d.opacity)},_matchCompositeOperation:function(s,d){s.setCompositeOperation(d.compositeOperation)}});function t(s){var d={tracker:s.eventSource,position:s.position,quick:s.quick,shift:s.shift,originalEvent:s.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",d),!d.preventDefaultAction&&s.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(s.position.x=this.viewport.getContainerSize().x-s.position.x);var g=this.viewport.pointFromPixel(s.position);this.panVertical?this.panHorizontal||(g.x=this.viewer.viewport.getCenter(!0).x):g.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(g),this.viewer.viewport.applyConstraints()}}function i(s){var d={tracker:s.eventSource,position:s.position,delta:s.delta,speed:s.speed,direction:s.direction,shift:s.shift,originalEvent:s.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",d),!d.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(s.delta.x=0),this.panVertical||(s.delta.y=0),this.viewer.viewport.flipped&&(s.delta.x=-s.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(s.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(s){s.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function u(s){var d={tracker:s.eventSource,position:s.position,scroll:s.scroll,shift:s.shift,originalEvent:s.originalEvent,preventDefault:s.preventDefault};this.viewer.raiseEvent("navigator-scroll",d),s.preventDefault=d.preventDefault}function a(s,d){r(s,"rotate("+d+"deg)")}function r(s,d){s.style.webkitTransform=d,s.style.mozTransform=d,s.style.msTransform=d,s.style.oTransform=d,s.style.transform=d}}(A),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(i){var n=i.split("."),u=null,a=arguments,r=t,s;for(s=0;s<n.length-1;s++)r=r[n[s]]||{};return u=r[n[s]],typeof u!="string"&&(e.console.log("Untranslated source string:",i),u=""),u.replace(/\{\d+\}/g,function(d){var g=parseInt(d.match(/\d+/),10)+1;return g<a.length?a[g]:""})},setString:function(i,n){var u=i.split("."),a=t,r;for(r=0;r<u.length-1;r++)a[u[r]]||(a[u[r]]={}),a=a[u[r]];a[u[r]]=n}})}(A),function(e){e.Point=function(t,i){this.x=typeof t=="number"?t:0,this.y=typeof i=="number"?i:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},squaredDistanceTo:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){i=i||new e.Point(0,0);var n,u;if(t%90===0){var a=e.positiveModulo(t,360);switch(a){case 0:n=1,u=0;break;case 90:n=0,u=1;break;case 180:n=-1,u=0;break;case 270:n=0,u=-1;break}}else{var r=t*Math.PI/180;n=Math.cos(r),u=Math.sin(r)}var s=n*(this.x-i.x)-u*(this.y-i.y)+i.x,d=u*(this.x-i.x)+n*(this.y-i.y)+i.y;return new e.Point(s,d)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(A),function(e){e.TileSource=function(i,n,u,a,r,s){var d=this,g=arguments,p,w;if(e.isPlainObject(i)?p=i:p={width:g[0],height:g[1],tileSize:g[2],tileOverlap:g[3],minLevel:g[4],maxLevel:g[5]},e.EventSource.call(this),e.extend(!0,this,p),!this.success){for(w=0;w<arguments.length;w++)if(e.isFunction(arguments[w])){this.success=arguments[w];break}}this.success&&this.addHandler("ready",function(T){d.success(T)}),e.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=p.width&&p.height?p.width/p.height:1,this.dimensions=new e.Point(p.width,p.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=p.tileOverlap?p.tileOverlap:0,this.minLevel=p.minLevel?p.minLevel:0,this.maxLevel=p.maxLevel!==void 0&&p.maxLevel!==null?p.maxLevel:p.width&&p.height?Math.ceil(Math.log(Math.max(p.width,p.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(i){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(i){return this._tileWidth?this._tileWidth:this.getTileSize(i)},getTileHeight:function(i){return this._tileHeight?this._tileHeight:this.getTileSize(i)},setMaxLevel:function(i){this.maxLevel=i,this._memoizeLevelScale()},getLevelScale:function(i){return this._memoizeLevelScale(),this.getLevelScale(i)},_memoizeLevelScale:function(){var i={},n;for(n=0;n<=this.maxLevel;n++)i[n]=1/Math.pow(2,this.maxLevel-n);this.getLevelScale=function(u){return i[u]}},getNumTiles:function(i){var n=this.getLevelScale(i),u=Math.ceil(n*this.dimensions.x/this.getTileWidth(i)),a=Math.ceil(n*this.dimensions.y/this.getTileHeight(i));return new e.Point(u,a)},getPixelRatio:function(i){var n=this.dimensions.times(this.getLevelScale(i)),u=1/n.x*e.pixelDensityRatio,a=1/n.y*e.pixelDensityRatio;return new e.Point(u,a)},getClosestLevel:function(){var i,n;for(i=this.minLevel+1;i<=this.maxLevel&&(n=this.getNumTiles(i),!(n.x>1||n.y>1));i++);return i-1},getTileAtPoint:function(i,n){var u=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio;e.console.assert(u,"[TileSource.getTileAtPoint] must be called with a valid point.");var a=this.dimensions.x*this.getLevelScale(i),r=n.x*a,s=n.y*a,d=Math.floor(r/this.getTileWidth(i)),g=Math.floor(s/this.getTileHeight(i));n.x>=1&&(d=this.getNumTiles(i).x-1);var p=1e-15;return n.y>=1/this.aspectRatio-p&&(g=this.getNumTiles(i).y-1),new e.Point(d,g)},getTileBounds:function(i,n,u,a){var r=this.dimensions.times(this.getLevelScale(i)),s=this.getTileWidth(i),d=this.getTileHeight(i),g=n===0?0:s*n-this.tileOverlap,p=u===0?0:d*u-this.tileOverlap,w=s+(n===0?1:2)*this.tileOverlap,T=d+(u===0?1:2)*this.tileOverlap,P=1/r.x;return w=Math.min(w,r.x-g),T=Math.min(T,r.y-p),a?new e.Rect(0,0,w,T):new e.Rect(g*P,p*P,w*P,T*P)},getImageInfo:function(i){var n=this,u,a,r,s,d,g,p;i&&(d=i.split("/"),g=d[d.length-1],p=g.lastIndexOf("."),p>-1&&(d[d.length-1]=g.slice(0,p))),a=function(w){typeof w=="string"&&(w=e.parseXml(w));var T=e.TileSource.determineType(n,w,i);if(!T){n.raiseEvent("open-failed",{message:"Unable to load TileSource",source:i});return}s=T.prototype.configure.apply(n,[w,i]),s.ajaxWithCredentials===void 0&&(s.ajaxWithCredentials=n.ajaxWithCredentials),r=new T(s),n.ready=!0,n.raiseEvent("ready",{tileSource:r})},i.match(/\.js$/)?(u=i.split("/").pop().replace(".js",""),e.jsonp({url:i,async:!1,callbackName:u,callback:a})):e.makeAjaxRequest({url:i,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(w){var T=t(w);a(T)},error:function(w,T){var P;try{P="HTTP "+w.status+" attempting to load TileSource"}catch{var x;typeof T=="undefined"||!T.toString?x="Unknown error":x=T.toString(),P=x+" attempting to load TileSource"}n.raiseEvent("open-failed",{message:P,source:i})}})},supports:function(i,n){return!1},configure:function(i,n){throw new Error("Method not implemented.")},getTileUrl:function(i,n,u){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(i,n,u){return{}},tileExists:function(i,n,u){var a=this.getNumTiles(i);return i>=this.minLevel&&i<=this.maxLevel&&n>=0&&u>=0&&n<a.x&&u<a.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype);function t(i){var n=i.responseText,u=i.status,a,r;if(i){if(i.status!==200&&i.status!==0)throw u=i.status,a=u===404?"Not Found":i.statusText,new Error(e.getString("Errors.Status",u,a))}else throw new Error(e.getString("Errors.Security"));if(n.match(/\s*<.*/))try{r=i.responseXML&&i.responseXML.documentElement?i.responseXML:e.parseXml(n)}catch{r=i.responseText}else if(n.match(/\s*[{[].*/))try{r=e.parseJSON(n)}catch{r=n}else r=n;return r}e.TileSource.determineType=function(i,n,u){var a;for(a in A)if(a.match(/.+TileSource$/)&&e.isFunction(A[a])&&e.isFunction(A[a].prototype.supports)&&A[a].prototype.supports.call(i,n,u))return A[a];return e.console.error("No TileSource was able to open %s %s",u,n),null}}(A),function(e){e.DziTileSource=function(n,u,a,r,s,d,g,p,w){var T,P,x,R;if(e.isPlainObject(n)?R=n:R={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=R.tilesUrl,this.fileFormat=R.fileFormat,this.displayRects=R.displayRects,this.displayRects)for(T=this.displayRects.length-1;T>=0;T--)for(P=this.displayRects[T],x=P.minLevel;x<=P.maxLevel;x++)this._levelRects[x]||(this._levelRects[x]=[]),this._levelRects[x].push(P);e.TileSource.apply(this,[R])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(n,u){var a;return n.Image?a=n.Image.xmlns:n.documentElement&&(n.documentElement.localName==="Image"||n.documentElement.tagName==="Image")&&(a=n.documentElement.namespaceURI),a=(a||"").toLowerCase(),a.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||a.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(n,u){var a;return e.isPlainObject(n)?a=i(this,n):a=t(this,n),u&&!a.tilesUrl&&(a.tilesUrl=u.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),u.search(/\.(dzi|xml|js)\?/)!==-1?a.queryParams=u.match(/\?.*/):a.queryParams=""),a},getTileUrl:function(n,u,a){return[this.tilesUrl,n,"/",u,"_",a,".",this.fileFormat,this.queryParams].join("")},tileExists:function(n,u,a){var r=this._levelRects[n],s,d,g,p,w,T,P;if(this.minLevel&&n<this.minLevel||this.maxLevel&&n>this.maxLevel)return!1;if(!r||!r.length)return!0;for(P=r.length-1;P>=0;P--)if(s=r[P],!(n<s.minLevel||n>s.maxLevel)&&(d=this.getLevelScale(n),g=s.x*d,p=s.y*d,w=g+s.width*d,T=p+s.height*d,g=Math.floor(g/this._tileWidth),p=Math.floor(p/this._tileWidth),w=Math.ceil(w/this._tileWidth),T=Math.ceil(T/this._tileWidth),g<=u&&u<w&&p<=a&&a<T))return!0;return!1}});function t(n,u){if(!u||!u.documentElement)throw new Error(e.getString("Errors.Xml"));var a=u.documentElement,r=a.localName||a.tagName,s=u.documentElement.namespaceURI,d=null,g=[],p,w,T,P,x;if(r==="Image")try{if(P=a.getElementsByTagName("Size")[0],P===void 0&&(P=a.getElementsByTagNameNS(s,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:a.getAttribute("Url"),Format:a.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(a.getAttribute("Overlap"),10),TileSize:parseInt(a.getAttribute("TileSize"),10),Size:{Height:parseInt(P.getAttribute("Height"),10),Width:parseInt(P.getAttribute("Width"),10)}}},!e.imageFormatSupported(d.Image.Format))throw new Error(e.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(p=a.getElementsByTagName("DisplayRect"),p===void 0&&(p=a.getElementsByTagNameNS(s,"DisplayRect")[0]),x=0;x<p.length;x++)w=p[x],T=w.getElementsByTagName("Rect")[0],T===void 0&&(T=w.getElementsByTagNameNS(s,"Rect")[0]),g.push({Rect:{X:parseInt(T.getAttribute("X"),10),Y:parseInt(T.getAttribute("Y"),10),Width:parseInt(T.getAttribute("Width"),10),Height:parseInt(T.getAttribute("Height"),10),MinLevel:parseInt(w.getAttribute("MinLevel"),10),MaxLevel:parseInt(w.getAttribute("MaxLevel"),10)}});return g.length&&(d.Image.DisplayRect=g),i(n,d)}catch(y){throw y instanceof Error?y:new Error(e.getString("Errors.Dzi"))}else{if(r==="Collection")throw new Error(e.getString("Errors.Dzc"));if(r==="Error"){var R=a.getElementsByTagName("Message")[0],l=R.firstChild.nodeValue;throw new Error(l)}}throw new Error(e.getString("Errors.Dzi"))}function i(n,u){var a=u.Image,r=a.Url,s=a.Format,d=a.Size,g=a.DisplayRect||[],p=parseInt(d.Width,10),w=parseInt(d.Height,10),T=parseInt(a.TileSize,10),P=parseInt(a.Overlap,10),x=[],R,l;for(l=0;l<g.length;l++)R=g[l].Rect,x.push(new e.DisplayRect(parseInt(R.X,10),parseInt(R.Y,10),parseInt(R.Width,10),parseInt(R.Height,10),parseInt(R.MinLevel,10),parseInt(R.MaxLevel,10)));return e.extend(!0,{width:p,height:w,tileSize:T,tileOverlap:P,minLevel:null,maxLevel:null,tilesUrl:r,fileFormat:s,displayRects:x},u)}}(A),function(e){e.IIIFTileSource=function(a){if(e.extend(!0,this,a),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(a.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=a.version,this.tile_width&&this.tile_height)a.tileWidth=this.tile_width,a.tileHeight=this.tile_height;else if(this.tile_width)a.tileSize=this.tile_width;else if(this.tile_height)a.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)a.tileWidth=this.tiles[0].width,a.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var r=0;r<this.tiles.length;r++)for(var s=0;s<this.tiles[r].scaleFactors.length;s++){var d=this.tiles[r].scaleFactors[s];this.scale_factors.push(d),a.tileSizePerScaleFactor[d]={width:this.tiles[r].width,height:this.tiles[r].height||this.tiles[r].width}}}else if(t(a)){for(var g=Math.min(this.height,this.width),p=[256,512,1024],w=[],T=0;T<p.length;T++)p[T]<=g&&w.push(p[T]);w.length>0?a.tileSize=Math.max.apply(null,w):a.tileSize=g}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,a.levels=i(this),e.extend(!0,a,{width:a.levels[a.levels.length-1].width,height:a.levels[a.levels.length-1].height,tileSize:Math.max(a.height,a.width),tileOverlap:0,minLevel:0,maxLevel:a.levels.length-1}),this.levels=a.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!a.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)a.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var P=Math.max.apply(null,this.scale_factors);a.maxLevel=Math.round(Math.log(P)*Math.LOG2E)}e.TileSource.apply(this,[a])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(a,r){return a.protocol&&a.protocol==="http://iiif.io/api/image"||a["@context"]&&(a["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||a["@context"]==="http://iiif.io/api/image/1/context.json")||a.profile&&a.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||a.identifier&&a.width&&a.height?!0:!!(a.documentElement&&a.documentElement.tagName==="info"&&a.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(a,r){if(e.isPlainObject(a)){if(!a["@context"])a["@context"]="http://iiif.io/api/image/1.0/context.json",a["@id"]=r.replace("/info.json",""),a.version=1;else{var d=a["@context"];if(Array.isArray(d)){for(var g=0;g<d.length;g++)if(typeof d[g]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(d[g])||d[g]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){d=d[g];break}}switch(d){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":a.version=1;break;case"http://iiif.io/api/image/2/context.json":a.version=2;break;case"http://iiif.io/api/image/3/context.json":a.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!a["@id"]&&a.id&&(a["@id"]=a.id),a.preferredFormats){for(var p=0;p<a.preferredFormats.length;p++)if(A.imageFormatSupported(a.preferredFormats[p])){a.tileFormat=a.preferredFormats[p];break}}return a}else{var s=n(a);return s["@context"]="http://iiif.io/api/image/1.0/context.json",s["@id"]=r.replace("/info.xml",""),s.version=1,s}},getTileWidth:function(a){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,a);var r=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[r]?this.tileSizePerScaleFactor[r].width:this._tileWidth},getTileHeight:function(a){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,a);var r=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[r]?this.tileSizePerScaleFactor[r].height:this._tileHeight},getLevelScale:function(a){if(this.emulateLegacyImagePyramid){var r=NaN;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(r=this.levels[a].width/this.levels[this.maxLevel].width),r}return e.TileSource.prototype.getLevelScale.call(this,a)},getNumTiles:function(a){if(this.emulateLegacyImagePyramid){var r=this.getLevelScale(a);return r?new e.Point(1,1):new e.Point(0,0)}return e.TileSource.prototype.getNumTiles.call(this,a)},getTileAtPoint:function(a,r){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,a,r)},getTileUrl:function(a,r,s){if(this.emulateLegacyImagePyramid){var d=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(d=this.levels[a].url),d}var g="0",p=Math.pow(.5,this.maxLevel-a),w=Math.ceil(this.width*p),T=Math.ceil(this.height*p),P,x,R,l,y,E,S,b,O,L,F,G,V,N;return P=this.getTileWidth(a),x=this.getTileHeight(a),R=Math.ceil(P/p),l=Math.ceil(x/p),this.version===1?V="native."+this.tileFormat:V="default."+this.tileFormat,w<P&&T<x?(this.version===2&&w===this.width?L="full":this.version===3&&w===this.width&&T===this.height?L="max":this.version===3?L=w+","+T:L=w+",",y="full"):(E=r*R,S=s*l,b=Math.min(R,this.width-E),O=Math.min(l,this.height-S),r===0&&s===0&&b===this.width&&O===this.height?y="full":y=[E,S,b,O].join(","),F=Math.ceil(b*p),G=Math.ceil(O*p),this.version===2&&F===this.width?L="full":this.version===3&&F===this.width&&G===this.height?L="max":this.version===3?L=F+","+G:L=F+","),N=[this["@id"],y,L,g,V].join("/"),N},__testonly__:{canBeTiled:t,constructLevels:i}});function t(a){var r=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],s=Array.isArray(a.profile)?a.profile[0]:a.profile,d=r.indexOf(s)!==-1,g=!1;return a.version===2&&a.profile.length>1&&a.profile[1].supports&&(g=a.profile[1].supports.indexOf("sizeByW")!==-1),a.version===3&&a.extraFeatures&&(g=a.extraFeatures.indexOf("sizeByWh")!==-1),!d||g}function i(a){for(var r=[],s=0;s<a.sizes.length;s++)r.push({url:a["@id"]+"/full/"+a.sizes[s].width+","+(a.version===3?a.sizes[s].height:"")+"/0/default."+a.tileFormat,width:a.sizes[s].width,height:a.sizes[s].height});return r.sort(function(d,g){return d.width-g.width})}function n(a){if(!a||!a.documentElement)throw new Error(e.getString("Errors.Xml"));var r=a.documentElement,s=r.tagName,d=null;if(s==="info")try{return d={},u(r,d),d}catch(g){throw g instanceof Error?g:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}function u(a,r,s){var d,g;if(a.nodeType===3&&s)g=a.nodeValue.trim(),g.match(/^\d*$/)&&(g=Number(g)),r[s]?(e.isArray(r[s])||(r[s]=[r[s]]),r[s].push(g)):r[s]=g;else if(a.nodeType===1)for(d=0;d<a.childNodes.length;d++)u(a.childNodes[d],r,a.nodeName)}}(A),function(e){e.OsmTileSource=function(t,i,n,u,a){var r;e.isPlainObject(t)?r=t:r={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!r.width||!r.height)&&(r.width=65572864,r.height=65572864),r.tileSize||(r.tileSize=256,r.tileOverlap=0),r.tilesUrl||(r.tilesUrl="http://tile.openstreetmap.org/"),r.minLevel=8,e.TileSource.apply(this,[r])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&t.type==="openstreetmaps"},configure:function(t,i){return t},getTileUrl:function(t,i,n){return this.tilesUrl+(t-8)+"/"+i+"/"+n+".png"}})}(A),function(e){e.TmsTileSource=function(t,i,n,u,a){var r;e.isPlainObject(t)?r=t:r={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var s=Math.ceil(r.width/256)*256,d=Math.ceil(r.height/256)*256,g;s>d?g=s/256:g=d/256,r.maxLevel=Math.ceil(Math.log(g)/Math.log(2))-1,r.tileSize=256,r.width=s,r.height=d,e.TileSource.apply(this,[r])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&t.type==="tiledmapservice"},configure:function(t,i){return t},getTileUrl:function(t,i,n){var u=this.getNumTiles(t).y-1;return this.tilesUrl+t+"/"+i+"/"+(u-n)+".png"}})}(A),function(e){e.ZoomifyTileSource=function(t){typeof t.tileSize=="undefined"&&(t.tileSize=256),typeof t.fileFormat=="undefined"&&(t.fileFormat="jpg",this.fileFormat=t.fileFormat);var i={x:t.width,y:t.height};for(t.imageSizes=[{x:t.width,y:t.height}],t.gridSize=[this._getGridSize(t.width,t.height,t.tileSize)];parseInt(i.x,10)>t.tileSize||parseInt(i.y,10)>t.tileSize;)i.x=Math.floor(i.x/2),i.y=Math.floor(i.y/2),t.imageSizes.push({x:i.x,y:i.y}),t.gridSize.push(this._getGridSize(i.x,i.y,t.tileSize));t.imageSizes.reverse(),t.gridSize.reverse(),t.minLevel=0,t.maxLevel=t.gridSize.length-1,A.TileSource.apply(this,[t])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(t,i,n){return{x:Math.ceil(t/n),y:Math.ceil(i/n)}},_calculateAbsoluteTileNumber:function(t,i,n){for(var u=0,a={},r=0;r<t;r++)a=this.gridSize[r],u+=a.x*a.y;return a=this.gridSize[t],u+=a.x*n+i,u},supports:function(t,i){return t.type&&t.type==="zoomifytileservice"},configure:function(t,i){return t},getTileUrl:function(t,i,n){var u=0,a=this._calculateAbsoluteTileNumber(t,i,n);return u=Math.floor(a/256),this.tilesUrl+"TileGroup"+u+"/"+t+"-"+i+"-"+n+"."+this.fileFormat}})}(A),function(e){e.LegacyTileSource=function(u){var a,r,s;e.isArray(u)&&(a={type:"legacy-image-pyramid",levels:u}),a.levels=t(a.levels),a.levels.length>0?(r=a.levels[a.levels.length-1].width,s=a.levels[a.levels.length-1].height):(r=0,s=0,e.console.error("No supported image formats found")),e.extend(!0,a,{width:r,height:s,tileSize:Math.max(s,r),tileOverlap:0,minLevel:0,maxLevel:a.levels.length>0?a.levels.length-1:0}),e.TileSource.apply(this,[a]),this.levels=a.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(u,a){return u.type&&u.type==="legacy-image-pyramid"||u.documentElement&&u.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(u,a){var r;return e.isPlainObject(u)?r=n(this,u):r=i(this,u),r},getLevelScale:function(u){var a=NaN;return this.levels.length>0&&u>=this.minLevel&&u<=this.maxLevel&&(a=this.levels[u].width/this.levels[this.maxLevel].width),a},getNumTiles:function(u){var a=this.getLevelScale(u);return a?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(u,a,r){var s=null;return this.levels.length>0&&u>=this.minLevel&&u<=this.maxLevel&&(s=this.levels[u].url),s}});function t(u){var a=[],r,s;for(s=0;s<u.length;s++)r=u[s],r.height&&r.width&&r.url?a.push({url:r.url,width:Number(r.width),height:Number(r.height)}):e.console.error("Unsupported image format: %s",r.url?r.url:"<no URL>");return a.sort(function(d,g){return d.height-g.height})}function i(u,a){if(!a||!a.documentElement)throw new Error(e.getString("Errors.Xml"));var r=a.documentElement,s=r.tagName,d=null,g=[],p,w;if(s==="image")try{for(d={type:r.getAttribute("type"),levels:[]},g=r.getElementsByTagName("level"),w=0;w<g.length;w++)p=g[w],d.levels.push({url:p.getAttribute("url"),width:parseInt(p.getAttribute("width"),10),height:parseInt(p.getAttribute("height"),10)});return n(u,d)}catch(T){throw T instanceof Error?T:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(s==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(s==="error")throw new Error("Error: "+a)}throw new Error("Unknown element "+s)}function n(u,a){return a.levels}}(A),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(t,i){return t.type&&t.type==="image"},configure:function(t,i){return t},getImageInfo:function(t){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),e.addEvent(i,"load",function(){n.width=i.naturalWidth,n.height=i.naturalHeight,n.aspectRatio=n.width/n.height,n.dimensions=new e.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),e.addEvent(i,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})}),i.src=t},getLevelScale:function(t){var i=NaN;return t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].width/this.levels[this.maxLevel].width),i},getNumTiles:function(t){var i=this.getLevelScale(t);return i?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(t,i,n){var u=null;return t>=this.minLevel&&t<=this.maxLevel&&(u=this.levels[t].url),u},getContext2D:function(t,i,n){var u=null;return t>=this.minLevel&&t<=this.maxLevel&&(u=this.levels[t].context2D),u},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var t=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var i=this._image.naturalWidth,n=this._image.naturalHeight,u=document.createElement("canvas"),a=u.getContext("2d");if(u.width=i,u.height=n,a.drawImage(this._image,0,0,i,n),t[0].context2D=a,delete this._image,e.isCanvasTainted(u))return t;for(;i>=2&&n>=2;){i=Math.floor(i/2),n=Math.floor(n/2);var r=document.createElement("canvas"),s=r.getContext("2d");r.width=i,r.height=n,s.drawImage(u,0,0,i,n),t.splice(0,0,{context2D:s,width:i,height:n}),u=r,a=s}return t},_freeupCanvasMemory:function(){for(var t=0;t<this.levels.length;t++)this.levels[t].context2D.canvas.height=0,this.levels[t].context2D.canvas.width=0}})}(A),function(e){e.TileSourceCollection=function(t,i,n,u){e.console.error("TileSourceCollection is deprecated; use World instead")}}(A),function(e){e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(s){var d=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},s),this.element=s.element||e.makeNeutralElement("div"),s.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor===e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(g){g.insideElementPressed?(a(d,e.ButtonState.DOWN),d.raiseEvent("enter",{originalEvent:g.originalEvent})):g.buttonDownAny||a(d,e.ButtonState.HOVER)},focusHandler:function(g){d.tracker.enterHandler(g),d.raiseEvent("focus",{originalEvent:g.originalEvent})},leaveHandler:function(g){r(d,e.ButtonState.GROUP),g.insideElementPressed&&d.raiseEvent("exit",{originalEvent:g.originalEvent})},blurHandler:function(g){d.tracker.leaveHandler(g),d.raiseEvent("blur",{originalEvent:g.originalEvent})},pressHandler:function(g){a(d,e.ButtonState.DOWN),d.raiseEvent("press",{originalEvent:g.originalEvent})},releaseHandler:function(g){g.insideElementPressed&&g.insideElementReleased?(r(d,e.ButtonState.HOVER),d.raiseEvent("release",{originalEvent:g.originalEvent})):g.insideElementPressed?r(d,e.ButtonState.GROUP):a(d,e.ButtonState.HOVER)},clickHandler:function(g){g.quick&&d.raiseEvent("click",{originalEvent:g.originalEvent})},keyHandler:function(g){g.keyCode===13?(d.raiseEvent("click",{originalEvent:g.originalEvent}),d.raiseEvent("release",{originalEvent:g.originalEvent}),g.preventDefault=!0):g.preventDefault=!1}}),r(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){a(this,e.ButtonState.GROUP)},notifyGroupExit:function(){r(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function t(s){e.requestAnimationFrame(function(){i(s)})}function i(s){var d,g,p;s.shouldFade&&(d=e.now(),g=d-s.fadeBeginTime,p=1-g/s.fadeLength,p=Math.min(1,p),p=Math.max(0,p),s.imgGroup&&e.setElementOpacity(s.imgGroup,p,!0),p>0&&t(s))}function n(s){s.shouldFade=!0,s.fadeBeginTime=e.now()+s.fadeDelay,window.setTimeout(function(){t(s)},s.fadeDelay)}function u(s){s.shouldFade=!1,s.imgGroup&&e.setElementOpacity(s.imgGroup,1,!0)}function a(s,d){s.element.disabled||(d>=e.ButtonState.GROUP&&s.currentState===e.ButtonState.REST&&(u(s),s.currentState=e.ButtonState.GROUP),d>=e.ButtonState.HOVER&&s.currentState===e.ButtonState.GROUP&&(s.imgHover&&(s.imgHover.style.visibility=""),s.currentState=e.ButtonState.HOVER),d>=e.ButtonState.DOWN&&s.currentState===e.ButtonState.HOVER&&(s.imgDown&&(s.imgDown.style.visibility=""),s.currentState=e.ButtonState.DOWN))}function r(s,d){s.element.disabled||(d<=e.ButtonState.HOVER&&s.currentState===e.ButtonState.DOWN&&(s.imgDown&&(s.imgDown.style.visibility="hidden"),s.currentState=e.ButtonState.HOVER),d<=e.ButtonState.GROUP&&s.currentState===e.ButtonState.HOVER&&(s.imgHover&&(s.imgHover.style.visibility="hidden"),s.currentState=e.ButtonState.GROUP),d<=e.ButtonState.REST&&s.currentState===e.ButtonState.GROUP&&(n(s),s.currentState=e.ButtonState.REST))}}(A),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i=this.buttons.concat([]),n=this,u;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",u=0;u<i.length;u++)this.element.appendChild(i[u].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(a){var r;for(r=0;r<n.buttons.length;r++)n.buttons[r].notifyGroupEnter()},leaveHandler:function(a){var r;if(!a.insideElementPressed)for(r=0;r<n.buttons.length;r++)n.buttons[r].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var t=this.buttons.pop();this.element.removeChild(t.element),t.destroy()}this.tracker.destroy(),this.element=null}}}(A),function(e){e.Rect=function(t,i,n,u,a){this.x=typeof t=="number"?t:0,this.y=typeof i=="number"?i:0,this.width=typeof n=="number"?n:0,this.height=typeof u=="number"?u:0,this.degrees=typeof a=="number"?a:0,this.degrees=e.positiveModulo(this.degrees,360);var r,s;this.degrees>=270?(r=this.getTopRight(),this.x=r.x,this.y=r.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=270):this.degrees>=180?(r=this.getBottomRight(),this.x=r.x,this.y=r.y,this.degrees-=180):this.degrees>=90&&(r=this.getBottomLeft(),this.x=r.x,this.y=r.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=90)},e.Rect.fromSummits=function(t,i,n){var u=t.distanceTo(i),a=t.distanceTo(n),r=i.minus(t),s=Math.atan(r.y/r.x);return r.x<0?s+=Math.PI:r.y<0&&(s+=2*Math.PI),new e.Rect(t.x,t.y,u,a,s/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var i=this.getBoundingBox(),n=t.getBoundingBox(),u=Math.min(i.x,n.x),a=Math.min(i.y,n.y),r=Math.max(i.x+i.width,n.x+n.width),s=Math.max(i.y+i.height,n.y+n.height);return new e.Rect(u,a,r-u,s-a)},intersection:function(t){var i=1e-10,n=[],u=this.getTopLeft();t.containsPoint(u,i)&&n.push(u);var a=this.getTopRight();t.containsPoint(a,i)&&n.push(a);var r=this.getBottomLeft();t.containsPoint(r,i)&&n.push(r);var s=this.getBottomRight();t.containsPoint(s,i)&&n.push(s);var d=t.getTopLeft();this.containsPoint(d,i)&&n.push(d);var g=t.getTopRight();this.containsPoint(g,i)&&n.push(g);var p=t.getBottomLeft();this.containsPoint(p,i)&&n.push(p);var w=t.getBottomRight();this.containsPoint(w,i)&&n.push(w);for(var T=this._getSegments(),P=t._getSegments(),x=0;x<T.length;x++)for(var R=T[x],l=0;l<P.length;l++){var y=P[l],E=S(R[0],R[1],y[0],y[1]);E&&n.push(E)}function S(N,q,j,J){var K=q.minus(N),te=J.minus(j),$=-te.x*K.y+K.x*te.y;if($===0)return null;var ne=(K.x*(N.y-j.y)-K.y*(N.x-j.x))/$,M=(te.x*(N.y-j.y)-te.y*(N.x-j.x))/$;return-i<=ne&&ne<=1-i&&-i<=M&&M<=1-i?new e.Point(N.x+M*K.x,N.y+M*K.y):null}if(n.length===0)return null;for(var b=n[0].x,O=n[0].x,L=n[0].y,F=n[0].y,G=1;G<n.length;G++){var V=n[G];V.x<b&&(b=V.x),V.x>O&&(O=V.x),V.y<L&&(L=V.y),V.y>F&&(F=V.y)}return new e.Rect(b,L,O-b,F-L)},_getSegments:function(){var t=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),u=this.getBottomRight();return[[t,i],[i,u],[u,n],[n,t]]},rotate:function(t,i){if(t=e.positiveModulo(t,360),t===0)return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(t,i),u=this.getTopRight().rotate(t,i),a=u.minus(n);a=a.apply(function(s){var d=1e-15;return Math.abs(s)<d?0:s});var r=Math.atan(a.y/a.x);return a.x<0?r+=Math.PI:a.y<0&&(r+=2*Math.PI),new e.Rect(n.x,n.y,this.width,this.height,r/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var t=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),u=this.getBottomRight(),a=Math.min(t.x,i.x,n.x,u.x),r=Math.max(t.x,i.x,n.x,u.x),s=Math.min(t.y,i.y,n.y,u.y),d=Math.max(t.y,i.y,n.y,u.y);return new e.Rect(a,s,r-a,d-s)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),i=Math.floor(t.x),n=Math.floor(t.y),u=Math.ceil(t.width+t.x-i),a=Math.ceil(t.height+t.y-n);return new e.Rect(i,n,u,a)},containsPoint:function(t,i){i=i||0;var n=this.getTopLeft(),u=this.getTopRight(),a=this.getBottomLeft(),r=u.minus(n),s=a.minus(n);return(t.x-n.x)*r.x+(t.y-n.y)*r.y>=-i&&(t.x-u.x)*r.x+(t.y-u.y)*r.y<=i&&(t.x-n.x)*s.x+(t.y-n.y)*s.y>=-i&&(t.x-a.x)*s.x+(t.y-a.y)*s.y<=i},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(A),function(e){var t={};e.ReferenceStrip=function(p){var w=this,T=p.viewer,P=e.getElementSize(T.element),x,R,l;for(p.id||(p.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=p.id,this.element.className="referencestrip"),p=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},p,{element:this.element}),e.extend(this,p),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,R=this.element.style,R.marginTop="0px",R.marginRight="0px",R.marginBottom="0px",R.marginLeft="0px",R.left="0px",R.bottom="0px",R.border="0px",R.background="#000",R.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=T,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,i),dragHandler:e.delegate(this,n),scrollHandler:e.delegate(this,u),enterHandler:e.delegate(this,r),leaveHandler:e.delegate(this,s),keyDownHandler:e.delegate(this,d),keyHandler:e.delegate(this,g),preProcessEventHandler:function(y){y.eventType==="wheel"&&(y.preventDefault=!0)}}),p.width&&p.height?(this.element.style.width=p.width+"px",this.element.style.height=p.height+"px",T.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):p.scroll==="horizontal"?(this.element.style.width=P.x*p.sizeRatio*T.tileSources.length+12*T.tileSources.length+"px",this.element.style.height=P.y*p.sizeRatio+"px",T.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=P.y*p.sizeRatio*T.tileSources.length+12*T.tileSources.length+"px",this.element.style.width=P.x*p.sizeRatio+"px",T.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=P.x*this.sizeRatio+8,this.panelHeight=P.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},l=0;l<T.tileSources.length;l++)x=e.makeNeutralElement("div"),x.id=this.element.id+"-"+l,x.style.width=w.panelWidth+"px",x.style.height=w.panelHeight+"px",x.style.display="inline",x.style.float="left",x.style.cssFloat="left",x.style.styleFloat="left",x.style.padding="2px",e.setElementTouchActionNone(x),e.setElementPointerEventsNone(x),this.element.appendChild(x),x.activePanel=!1,this.panels.push(x);a(this,this.scroll==="vertical"?P.y:P.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(p){var w=this.element.querySelector("#"+this.element.id+"-"+p),T=e.getElementSize(this.viewer.canvas),P=Number(this.element.style.width.replace("px","")),x=Number(this.element.style.height.replace("px","")),R=-Number(this.element.style.marginLeft.replace("px","")),l=-Number(this.element.style.marginTop.replace("px","")),y;this.currentSelected!==w&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=w,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(y=Number(p)*(this.panelWidth+3),y>R+T.x-this.panelWidth?(y=Math.min(y,P-T.x),this.element.style.marginLeft=-y+"px",a(this,T.x,-y)):y<R&&(y=Math.max(0,y-T.x/2),this.element.style.marginLeft=-y+"px",a(this,T.x,-y))):(y=Number(p)*(this.panelHeight+3),y>l+T.y-this.panelHeight?(y=Math.min(y,x-T.y),this.element.style.marginTop=-y+"px",a(this,T.y,-y)):y<l&&(y=Math.max(0,y-T.y/2),this.element.style.marginTop=-y+"px",a(this,T.y,-y))),this.currentPage=p,r.call(this,{eventSource:this.tracker}))},update:function(){return t[this.id].animating?(e.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var p in this.miniViewers)this.miniViewers[p].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function i(p){if(p.quick){var w;this.scroll==="horizontal"?w=Math.floor(p.position.x/this.panelWidth):w=Math.floor(p.position.y/this.panelHeight),this.viewer.goToPage(w)}this.element.focus()}function n(p){if(this.dragging=!0,this.element){var w=Number(this.element.style.marginLeft.replace("px","")),T=Number(this.element.style.marginTop.replace("px","")),P=Number(this.element.style.width.replace("px","")),x=Number(this.element.style.height.replace("px","")),R=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-p.delta.x>0?w>-(P-R.x)&&(this.element.style.marginLeft=w+p.delta.x*2+"px",a(this,R.x,w+p.delta.x*2)):-p.delta.x<0&&w<0&&(this.element.style.marginLeft=w+p.delta.x*2+"px",a(this,R.x,w+p.delta.x*2)):-p.delta.y>0?T>-(x-R.y)&&(this.element.style.marginTop=T+p.delta.y*2+"px",a(this,R.y,T+p.delta.y*2)):-p.delta.y<0&&T<0&&(this.element.style.marginTop=T+p.delta.y*2+"px",a(this,R.y,T+p.delta.y*2))}}function u(p){if(this.element){var w=Number(this.element.style.marginLeft.replace("px","")),T=Number(this.element.style.marginTop.replace("px","")),P=Number(this.element.style.width.replace("px","")),x=Number(this.element.style.height.replace("px","")),R=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?p.scroll>0?w>-(P-R.x)&&(this.element.style.marginLeft=w-p.scroll*60+"px",a(this,R.x,w-p.scroll*60)):p.scroll<0&&w<0&&(this.element.style.marginLeft=w-p.scroll*60+"px",a(this,R.x,w-p.scroll*60)):p.scroll<0?T>R.y-x&&(this.element.style.marginTop=T+p.scroll*60+"px",a(this,R.y,T+p.scroll*60)):p.scroll>0&&T<0&&(this.element.style.marginTop=T+p.scroll*60+"px",a(this,R.y,T+p.scroll*60)),p.preventDefault=!0}}function a(p,w,T){var P,x,R,l,y,E;for(p.scroll==="horizontal"?P=p.panelWidth:P=p.panelHeight,x=Math.ceil(w/P)+5,R=Math.ceil((Math.abs(T)+w)/P)+1,x=R-x,x=x<0?0:x,y=x;y<R&&y<p.panels.length;y++)if(E=p.panels[y],!E.activePanel){var S,b=p.viewer.tileSources[y];b.referenceStripThumbnailUrl?S={type:"image",url:b.referenceStripThumbnailUrl}:S=b,l=new e.Viewer({id:E.id,tileSources:[S],element:E,navigatorSizeRatio:p.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:p.viewer.loadTilesWithAjax,ajaxHeaders:p.viewer.ajaxHeaders,useCanvas:p.useCanvas}),e.setElementPointerEventsNone(l.canvas),e.setElementPointerEventsNone(l.container),l.innerTracker.setTracking(!1),l.outerTracker.setTracking(!1),p.miniViewers[E.id]=l,E.activePanel=!0}}function r(p){var w=p.eventSource.element;this.scroll==="horizontal"?w.style.marginBottom="0px":w.style.marginLeft="0px"}function s(p){var w=p.eventSource.element;this.scroll==="horizontal"?w.style.marginBottom="-"+e.getElementSize(w).y/2+"px":w.style.marginLeft="-"+e.getElementSize(w).x/2+"px"}function d(p){if(!p.ctrl&&!p.alt&&!p.meta)switch(p.keyCode){case 38:u.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),p.preventDefault=!0;break;case 40:u.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),p.preventDefault=!0;break;case 37:u.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),p.preventDefault=!0;break;case 39:u.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),p.preventDefault=!0;break;default:p.preventDefault=!1;break}else p.preventDefault=!1}function g(p){if(!p.ctrl&&!p.alt&&!p.meta)switch(p.keyCode){case 61:u.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),p.preventDefault=!0;break;case 45:u.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),p.preventDefault=!0;break;case 48:case 119:case 87:u.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),p.preventDefault=!0;break;case 115:case 83:u.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),p.preventDefault=!0;break;case 97:u.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),p.preventDefault=!0;break;case 100:u.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),p.preventDefault=!0;break;default:p.preventDefault=!1;break}else p.preventDefault=!1}}(A),function(e){e.DisplayRect=function(t,i,n,u,a,r){e.Rect.apply(this,[t,i,n,u]),this.minLevel=a,this.maxLevel=r},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(A),function(e){e.Spring=function(i){var n=arguments;typeof i!="object"&&(i={initial:n.length&&typeof n[0]=="number"?n[0]:void 0,springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),e.console.assert(typeof i.springStiffness=="number"&&i.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert(typeof i.animationTime=="number"&&i.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),i.exponential&&(this._exponential=!0,delete i.exponential),e.extend(!0,this,i),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(i){e.console.assert(!this._exponential||i!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=i,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(i){e.console.assert(!this._exponential||i!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=i,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(i){this.start.value+=i,this.target.value+=i,this._exponential&&(e.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(i){this._exponential=i,this._exponential&&(e.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=e.now();var i,n;this._exponential?(i=this.start._logValue,n=this.target._logValue):(i=this.start.value,n=this.target.value);var u=this.current.time>=this.target.time?n:i+(n-i)*t(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),a=this.current.value;return this._exponential?this.current.value=Math.exp(u):this.current.value=u,a!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function t(i,n){return(1-Math.exp(i*-n))/(1-Math.exp(-i))}}(A),function(e){function t(n){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},n),this.image=null}t.prototype={errorMsg:null,start:function(){var n=this,u=this.abort;this.image=new Image,this.image.onload=function(){n.finish(!0)},this.image.onabort=this.image.onerror=function(){n.errorMsg="Image load aborted",n.finish(!1)},this.jobId=window.setTimeout(function(){n.errorMsg="Image load exceeded timeout ("+n.timeout+" ms)",n.finish(!1)},this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(a){var r;try{r=new window.Blob([a.response])}catch(p){var s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(p.name==="TypeError"&&s){var d=new s;d.append(a.response),r=d.getBlob()}}r.size===0&&(n.errorMsg="Empty image response.",n.finish(!1));var g=(window.URL||window.webkitURL).createObjectURL(r);n.image.src=g},error:function(a){n.errorMsg="Image load aborted - XHR error",n.finish(!1)}}),this.abort=function(){n.request.abort(),typeof u=="function"&&u()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(n){this.image.onload=this.image.onerror=this.image.onabort=null,n||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(n){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},n)},e.ImageLoader.prototype={addJob:function(n){var u=this,a=function(d){i(u,d,n.callback)},r={src:n.src,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.loadWithAjax?n.ajaxHeaders:null,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,callback:a,abort:n.abort,timeout:this.timeout},s=new t(r);!this.jobLimit||this.jobsInProgress<this.jobLimit?(s.start(),this.jobsInProgress++):this.jobQueue.push(s)},clear:function(){for(var n=0;n<this.jobQueue.length;n++){var u=this.jobQueue[n];typeof u.abort=="function"&&u.abort()}this.jobQueue=[]}};function i(n,u,a){var r;n.jobsInProgress--,(!n.jobLimit||n.jobsInProgress<n.jobLimit)&&n.jobQueue.length>0&&(r=n.jobQueue.shift(),r.start(),n.jobsInProgress++),a(u.image,u.errorMsg,u.request)}}(A),function(e){e.Tile=function(t,i,n,u,a,r,s,d,g,p){this.level=t,this.x=i,this.y=n,this.bounds=u,this.sourceBounds=p,this.exists=a,this.url=r,this.context2D=s,this.loadWithAjax=d,this.ajaxHeaders=g,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(t){if(!this.cacheImageRecord){e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!==t&&t.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),e.setElementOpacity(this.element,this.opacity)},drawCanvas:function(t,i,n,u){var a=this.position.times(e.pixelDensityRatio),r=this.size.times(e.pixelDensityRatio),s;if(!this.context2D&&!this.cacheImageRecord){e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(s=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!s){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}t.save(),t.globalAlpha=this.opacity,typeof n=="number"&&n!==1&&(a=a.times(n),r=r.times(n)),u instanceof e.Point&&(a=a.plus(u)),t.globalAlpha===1&&this._hasTransparencyChannel()&&t.clearRect(a.x,a.y,r.x,r.y),i({context:t,tile:this,rendered:s});var d,g;this.sourceBounds?(d=Math.min(this.sourceBounds.width,s.canvas.width),g=Math.min(this.sourceBounds.height,s.canvas.height)):(d=s.canvas.width,g=s.canvas.height),t.translate(a.x+r.x/2,0),this.flipped&&t.scale(-1,1),t.drawImage(s.canvas,0,0,d,g,-r.x/2,a.y,r.x,r.y),t.restore()},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else if(this.context2D)t=this.context2D;else return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,i,n){var u=Math.max(1,Math.ceil((n.x-i.x)/2)),a=Math.max(1,Math.ceil((n.y-i.y)/2));return new e.Point(u,a).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply(function(r){return r%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(A),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,i,n){var u;e.isPlainObject(t)?u=t:u={element:t,location:i,placement:n},this.element=u.element,this.style=u.element.style,this._init(u)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=t.placement===void 0?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=t.checkResize===void 0?!0:t.checkResize,this.width=t.width===void 0?null:t.width,this.height=t.height===void 0?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,i){var n=e.Placement.properties[this.placement];!n||(n.isHorizontallyCentered?t.x-=i.x/2:n.isRight&&(t.x-=i.x),n.isVerticallyCentered?t.y-=i.y/2:n.isBottom&&(t.y-=i.y))},destroy:function(){var t=this.element,i=this.style;t.parentNode&&(t.parentNode.removeChild(t),t.prevElementParent&&(i.display="none",document.body.appendChild(t))),this.onDraw=null,i.top="",i.left="",i.position="",this.width!==null&&(i.width=""),this.height!==null&&(i.height="");var n=e.getCssPropertyWithVendorPrefix("transformOrigin"),u=e.getCssPropertyWithVendorPrefix("transform");n&&u&&(i[n]="",i[u]="")},drawHTML:function(t,i){var n=this.element;n.parentNode!==t&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,t.appendChild(n),this.style.position="absolute",this.size=e.getElementSize(n));var u=this._getOverlayPositionAndSize(i),a=u.position,r=this.size=u.size,s=u.rotate;if(this.onDraw)this.onDraw(a,r,this.element);else{var d=this.style;d.left=a.x+"px",d.top=a.y+"px",this.width!==null&&(d.width=r.x+"px"),this.height!==null&&(d.height=r.y+"px");var g=e.getCssPropertyWithVendorPrefix("transformOrigin"),p=e.getCssPropertyWithVendorPrefix("transform");g&&p&&(s?(d[g]=this._getTransformOrigin(),d[p]="rotate("+s+"deg)"):(d[g]="",d[p]="")),d.display="block"}},_getOverlayPositionAndSize:function(t){var i=t.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(t);this.adjust(i,n);var u=0;if(t.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var a=new e.Rect(i.x,i.y,n.x,n.y),r=this._getBoundingBox(a,t.degrees);i=r.getTopLeft(),n=r.getSize()}else u=t.degrees;return{position:i,size:n,rotate:u}},_getSizeInPixels:function(t){var i=this.size.x,n=this.size.y;if(this.width!==null||this.height!==null){var u=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);this.width!==null&&(i=u.x),this.height!==null&&(n=u.y)}if(this.checkResize&&(this.width===null||this.height===null)){var a=this.size=e.getElementSize(this.element);this.width===null&&(i=a.x),this.height===null&&(n=a.y)}return new e.Point(i,n)},_getBoundingBox:function(t,i){var n=this._getPlacementPoint(t);return t.rotate(i,n).getBoundingBox()},_getPlacementPoint:function(t){var i=new e.Point(t.x,t.y),n=e.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=t.width/2:n.isRight&&(i.x+=t.width),n.isVerticallyCentered?i.y+=t.height/2:n.isBottom&&(i.y+=t.height)),i},_getTransformOrigin:function(){var t="",i=e.Placement.properties[this.placement];return i&&(i.isLeft?t="left":i.isRight&&(t="right"),i.isTop?t+=" top":i.isBottom&&(t+=" bottom")),t},update:function(t,i){var n=e.isPlainObject(t)?t:{location:t,placement:i};this._init({location:n.location||this.location,placement:n.placement!==void 0?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:n.width!==void 0?n.width:this.width,height:n.height!==void 0?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(i===null||n===null){var u=t.deltaPointsFromPixelsNoRotate(this.size,!0);i===null&&(i=u.x),n===null&&(n=u.y)}var a=this.location.clone();return this.adjust(a,new e.Point(i,n)),this._adjustBoundsForRotation(t,new e.Rect(a.x,a.y,i,n))},_adjustBoundsForRotation:function(t,i){if(!t||t.degrees===0||this.rotationMode===e.OverlayRotationMode.EXACT)return i;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return i;var n=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return i.rotate(-t.degrees,this._getPlacementPoint(i))}}}(A),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var i=arguments;if(e.isPlainObject(t)||(t={source:i[0],viewport:i[1],element:i[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor=typeof t.debugGridColor=="string"?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(t,i,n,u){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,i,n,u),this},updateOverlay:function(t,i,n){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,i,n),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(t){var i=this.viewport.pixelFromPointNoRotate(t,!0);return new e.Point(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio)},clipWithPolygons:function(t,i){if(!!this.useCanvas){var n=this._getContext(i);n.beginPath(),t.forEach(function(u){u.forEach(function(a,r){n[r===0?"moveTo":"lineTo"](a.x,a.y)})}),n.clip()}},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,i=0,n=0;n<t.getItemCount();n++){var u=t.getItemAt(n).getOpacity();u>i&&(i=u)}return i},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var t=this._calculateCanvasSize();if((this.canvas.width!==t.x||this.canvas.height!==t.y)&&(this.canvas.width=t.x,this.canvas.height=t.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var i=this._calculateSketchCanvasSize();this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(t,i){if(!!this.useCanvas){var n=this._getContext(t);if(i)n.clearRect(i.x,i.y,i.width,i.height);else{var u=n.canvas;n.clearRect(0,0,u.width,u.height)}}},viewportToDrawerRectangle:function(t){var i=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},drawTile:function(t,i,n,u,a){if(e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var r=this._getContext(n);u=u||1,t.drawCanvas(r,i,u,a)}else t.drawHTML(this.canvas)},_getContext:function(t){var i=this.context;if(t){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var n=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var u=this;this.viewer.addHandler("rotate",function a(){if(u.viewport.getRotation()!==0){u.viewer.removeHandler("rotate",a);var r=u._calculateSketchCanvasSize();u.sketchCanvas.width=r.x,u.sketchCanvas.height=r.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}i=this.sketchContext}return i},saveContext:function(t){!this.useCanvas||this._getContext(t).save()},restoreContext:function(t){!this.useCanvas||this._getContext(t).restore()},setClip:function(t,i){if(!!this.useCanvas){var n=this._getContext(i);n.beginPath(),n.rect(t.x,t.y,t.width,t.height),n.clip()}},drawRectangle:function(t,i,n){if(!!this.useCanvas){var u=this._getContext(n);u.save(),u.fillStyle=i,u.fillRect(t.x,t.y,t.width,t.height),u.restore()}},blendSketch:function(t,i,n,u){var a=t;if(e.isPlainObject(a)||(a={opacity:t,scale:i,translate:n,compositeOperation:u}),!(!this.useCanvas||!this.sketchCanvas)){t=a.opacity,u=a.compositeOperation;var r=a.bounds;if(this.context.save(),this.context.globalAlpha=t,u&&(this.context.globalCompositeOperation=u),r)r.x<0&&(r.width+=r.x,r.x=0),r.x+r.width>this.canvas.width&&(r.width=this.canvas.width-r.x),r.y<0&&(r.height+=r.y,r.y=0),r.y+r.height>this.canvas.height&&(r.height=this.canvas.height-r.y),this.context.drawImage(this.sketchCanvas,r.x,r.y,r.width,r.height,r.x,r.y,r.width,r.height);else{i=a.scale||1,n=a.translate;var s=n instanceof e.Point?n:new e.Point(0,0),d=0,g=0;if(n){var p=this.sketchCanvas.width-this.canvas.width,w=this.sketchCanvas.height-this.canvas.height;d=Math.round(p/2),g=Math.round(w/2)}this.context.drawImage(this.sketchCanvas,s.x-d*i,s.y-g*i,(this.canvas.width+2*d)*i,(this.canvas.height+2*g)*i,-d,-g,this.canvas.width+2*d,this.canvas.height+2*g)}this.context.restore()}},drawDebugInfo:function(t,i,n,u){if(!!this.useCanvas){var a=this.viewer.world.getIndexOfItem(u)%this.debugGridColor.length,r=this.context;r.save(),r.lineWidth=2*e.pixelDensityRatio,r.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",r.strokeStyle=this.debugGridColor[a],r.fillStyle=this.debugGridColor[a],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),u.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:u.getRotation(!0),point:u.viewport.pixelFromPointNoRotate(u._getRotationPoint(!0),!0)}),u.viewport.degrees===0&&u.getRotation(!0)%360===0&&u._drawer.viewer.viewport.getFlip()&&u._drawer._flip(),r.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var s=(t.position.x+t.size.x/2)*e.pixelDensityRatio,d=(t.position.y+t.size.y/2)*e.pixelDensityRatio;r.translate(s,d),r.rotate(Math.PI/180*-this.viewport.degrees),r.translate(-s,-d),t.x===0&&t.y===0&&(r.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),r.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),r.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),r.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),r.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),r.fillText("Order: "+n+" of "+i,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),r.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),r.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),u.getRotation(!0)%360!==0&&this._restoreRotationChanges(),u.viewport.degrees===0&&u.getRotation(!0)%360===0&&u._drawer.viewer.viewport.getFlip()&&u._drawer._flip(),r.restore()}},debugRect:function(t){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),i.restore()}},setImageSmoothingEnabled:function(t){this.useCanvas&&(this._imageSmoothingEnabled=t,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(t){t.msImageSmoothingEnabled=this._imageSmoothingEnabled,t.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(t){var i=this._getContext(t).canvas;return new e.Point(i.width,i.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var i=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.save(),n.translate(i.x,i.y),this.viewer.viewport.flipped?(n.rotate(Math.PI/180*-t.degrees),n.scale(-1,1)):n.rotate(Math.PI/180*t.degrees),n.translate(-i.x,-i.y)},_flip:function(t){t=t||{};var i=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.translate(i.x,0),n.scale(-1,1),n.translate(-i.x,0)},_restoreRotationChanges:function(t){var i=this._getContext(t);i.restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:Math.round(i.x*t),y:Math.round(i.y*t)}},_calculateSketchCanvasSize:function(){var t=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return t;var i=Math.ceil(Math.sqrt(t.x*t.x+t.y*t.y));return{x:i,y:i}}}}(A),function(e){e.Viewport=function(t){var i=arguments;i.length&&i[0]instanceof e.Point&&(t={containerSize:i[0],contentSize:i[1],config:i[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(t.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(t.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,i){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,i)},_setContentBounds:function(t,i){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(t.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(t.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=t.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var t=this._contentAspectRatio/this.getAspectRatio(),i;return this.homeFillsViewer?i=t>=1?t:1:i=t>=1?1:t,i/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-n/2,i,n)},goHome:function(t){return this.viewer&&this.viewer.raiseEvent("home",{immediately:t}),this.fitBounds(this.getHomeBounds(),t)},getMinZoom:function(){var t=this.getHomeZoom(),i=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*t;return i},getMaxZoom:function(){var t=this.maxZoomLevel;return t||(t=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,t/=this._contentBounds.width),Math.max(t,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert(e.type(t)==="object","[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(t){return this.getBoundsNoRotate(t).rotate(-this.getRotation())},getBoundsNoRotate:function(t){var i=this.getCenter(t),n=1/this.getZoom(t),u=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-u/2,n,u)},getBoundsWithMargins:function(t){return this.getBoundsNoRotateWithMargins(t).rotate(-this.getRotation(),this.getCenter(t))},getBoundsNoRotateWithMargins:function(t){var i=this.getBoundsNoRotate(t),n=this._containerInnerSize.x*this.getZoom(t);return i.x-=this._margins.left/n,i.y-=this._margins.top/n,i.width+=(this._margins.left+this._margins.right)/n,i.height+=(this._margins.top+this._margins.bottom)/n,i},getCenter:function(t){var i=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),u,a,r,s,d,g,p,w;return t?i:this.zoomPoint?(u=this.pixelFromPoint(this.zoomPoint,!0),a=this.getZoom(),r=1/a,s=r/this.getAspectRatio(),d=new e.Rect(i.x-r/2,i.y-s/2,r,s),g=this._pixelFromPoint(this.zoomPoint,d),p=g.minus(u),w=p.divide(this._containerInnerSize.x*a),n.plus(w)):n},getZoom:function(t){return t?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(t){return Math.max(Math.min(t,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){var i=new e.Rect(t.x,t.y,t.width,t.height);if(!this.wrapHorizontal){var n=this.visibilityRatio*i.width,u=i.x+i.width,a=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,r=this._contentBoundsNoRotate.x-u+n,s=a-i.x-n;n>this._contentBoundsNoRotate.width?i.x+=(r+s)/2:s<0?i.x+=s:r>0&&(i.x+=r)}if(!this.wrapVertical){var d=this.visibilityRatio*i.height,g=i.y+i.height,p=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,w=this._contentBoundsNoRotate.y-g+d,T=p-i.y-d;d>this._contentBoundsNoRotate.height?i.y+=(w+T)/2:T<0?i.y+=T:w>0&&(i.y+=w)}return i},_raiseConstraintsEvent:function(t){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:t})},applyConstraints:function(t){var i=this.getZoom(),n=this._applyZoomConstraints(i);i!==n&&this.zoomTo(n,this.zoomPoint,t);var u=this.getBoundsNoRotate(),a=this._applyBoundaryConstraints(u);return this._raiseConstraintsEvent(t),(u.x!==a.x||u.y!==a.y||t)&&this.fitBounds(a.rotate(-this.getRotation()),t),this},ensureVisible:function(t){return this.applyConstraints(t)},_fitBounds:function(t,i){i=i||{};var n=i.immediately||!1,u=i.constraints||!1,a=this.getAspectRatio(),r=t.getCenter(),s=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();s.getAspectRatio()>=a?s.height=s.width/a:s.width=s.height*a,s.x=r.x-s.width/2,s.y=r.y-s.height/2;var d=1/s.width;if(u){var g=s.getAspectRatio(),p=this._applyZoomConstraints(d);d!==p&&(d=p,s.width=1/d,s.x=r.x-s.width/2,s.height=s.width/g,s.y=r.y-s.height/2),s=this._applyBoundaryConstraints(s),r=s.getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(r,!0),this.zoomTo(d,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var w=this.getBounds(),T=this.getZoom();if(T===0||Math.abs(d/T-1)<1e-8)return this.zoomTo(d,!0),this.panTo(r,n);s=s.rotate(-this.getRotation());var P=s.getTopLeft().times(d).minus(w.getTopLeft().times(T)).divide(d-T);return this.zoomTo(d,P,n)},fitBounds:function(t,i){return this._fitBounds(t,{immediately:i,constraints:!1})},fitBoundsWithConstraints:function(t,i){return this._fitBounds(t,{immediately:i,constraints:!0})},fitVertically:function(t){var i=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,t)},fitHorizontally:function(t){var i=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,t)},getConstrainedBounds:function(t){var i,n;return i=this.getBounds(t),n=this._applyBoundaryConstraints(i),n},panBy:function(t,i){var n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(t),i)},panTo:function(t,i){return i?(this.centerSpringX.resetTo(t.x),this.centerSpringY.resetTo(t.y)):(this.centerSpringX.springTo(t.x),this.centerSpringY.springTo(t.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:t,immediately:i}),this},zoomBy:function(t,i,n){return this.zoomTo(this.zoomSpring.target.value*t,i,n)},zoomTo:function(t,i,n){var u=this;return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint(function(){u.zoomSpring.resetTo(t)}):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:n}),this},setRotation:function(t){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=e.positiveModulo(t,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t}),this)},getRotation:function(){return this.degrees},resize:function(t,i){var n=this.getBoundsNoRotate(),u=n,a;return this.containerSize.x=t.x,this.containerSize.y=t.y,this._updateContainerInnerSize(),i&&(a=t.x/this.containerSize.x,u.width=n.width*a,u.height=u.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:i}),this.fitBounds(u,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var t=this;this._adjustCenterSpringsForZoomPoint(function(){t.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var i=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,i},_adjustCenterSpringsForZoomPoint:function(t){if(this.zoomPoint){var i=this.pixelFromPoint(this.zoomPoint,!0);t();var n=this.pixelFromPoint(this.zoomPoint,!0),u=n.minus(i),a=this.deltaPointsFromPixels(u,!0);this.centerSpringX.shiftBy(a.x),this.centerSpringY.shiftBy(a.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else t()},deltaPixelsFromPointsNoRotate:function(t,i){return t.times(this._containerInnerSize.x*this.getZoom(i))},deltaPixelsFromPoints:function(t,i){return this.deltaPixelsFromPointsNoRotate(t.rotate(this.getRotation()),i)},deltaPointsFromPixelsNoRotate:function(t,i){return t.divide(this._containerInnerSize.x*this.getZoom(i))},deltaPointsFromPixels:function(t,i){return this.deltaPointsFromPixelsNoRotate(t,i).rotate(-this.getRotation())},pixelFromPointNoRotate:function(t,i){return this._pixelFromPointNoRotate(t,this.getBoundsNoRotate(i))},pixelFromPoint:function(t,i){return this._pixelFromPoint(t,this.getBoundsNoRotate(i))},_pixelFromPointNoRotate:function(t,i){return t.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(t,i){return this._pixelFromPointNoRotate(t.rotate(this.getRotation(),this.getCenter(!0)),i)},pointFromPixelNoRotate:function(t,i){var n=this.getBoundsNoRotate(i);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(t,i){return this.pointFromPixelNoRotate(t,i).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(t,i){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(n===1){var u=this.viewer.world.getItemAt(0);return u.viewportToImageCoordinates(t,i,!0)}}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(t,i){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(n===1){var u=this.viewer.world.getItemAt(0);return u.imageToViewportCoordinates(t,i,!0)}}var a=this._imageToViewportDelta(t,i);return a.x+=this._contentBoundsNoRotate.x,a.y+=this._contentBoundsNoRotate.y,a},imageToViewportRectangle:function(t,i,n,u){var a=t;if(a instanceof e.Rect||(a=new e.Rect(t,i,n,u)),this.viewer){var r=this.viewer.world.getItemCount();if(r>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(r===1){var s=this.viewer.world.getItemAt(0);return s.imageToViewportRectangle(t,i,n,u,!0)}}var d=this.imageToViewportCoordinates(a.x,a.y),g=this._imageToViewportDelta(a.width,a.height);return new e.Rect(d.x,d.y,g.x,g.y,a.degrees)},viewportToImageRectangle:function(t,i,n,u){var a=t;if(a instanceof e.Rect||(a=new e.Rect(t,i,n,u)),this.viewer){var r=this.viewer.world.getItemCount();if(r>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(r===1){var s=this.viewer.world.getItemAt(0);return s.viewportToImageRectangle(t,i,n,u,!0)}}var d=this.viewportToImageCoordinates(a.x,a.y),g=this._viewportToImageDelta(a.width,a.height);return new e.Rect(d.x,d.y,g.x,g.y,a.degrees)},viewerElementToImageCoordinates:function(t){var i=this.pointFromPixel(t,!0);return this.viewportToImageCoordinates(i)},imageToViewerElementCoordinates:function(t){var i=this.imageToViewportCoordinates(t);return this.pixelFromPoint(i,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var i=this.imageToViewerElementCoordinates(t);return i.plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(t){return this.pointFromPixel(t,!0)},viewportToViewerElementCoordinates:function(t){return this.pixelFromPoint(t,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var i=this.viewportToViewerElementCoordinates(t);return i.plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(i===1){var n=this.viewer.world.getItemAt(0);return n.viewportToImageZoom(t)}}var u=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,r=this._contentBoundsNoRotate.width,s=a/u*r;return t*s},imageToViewportZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(i===1){var n=this.viewer.world.getItemAt(0);return n.imageToViewportZoom(t)}}var u=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,r=this._contentBoundsNoRotate.width,s=u/a/r;return t*s},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(t){return this.flipped===t?this:(this.flipped=t,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:t}),this)}}}(A),function(e){e.TiledImage=function(l){var y=this;e.console.assert(l.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(l.drawer,"[TiledImage] options.drawer is required"),e.console.assert(l.viewer,"[TiledImage] options.viewer is required"),e.console.assert(l.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(l.source,"[TiledImage] options.source is required"),e.console.assert(!l.clip||l.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=l.tileCache,delete l.tileCache,this._drawer=l.drawer,delete l.drawer,this._imageLoader=l.imageLoader,delete l.imageLoader,l.clip instanceof e.Rect&&(this._clip=l.clip.clone()),delete l.clip;var E=l.x||0;delete l.x;var S=l.y||0;delete l.y,this.normHeight=l.source.dimensions.y/l.source.dimensions.x,this.contentAspectX=l.source.dimensions.x/l.source.dimensions.y;var b=1;l.width?(b=l.width,delete l.width,l.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete l.height)):l.height&&(b=l.height/this.normHeight,delete l.height);var O=l.fitBounds;delete l.fitBounds;var L=l.fitBoundsPlacement||A.Placement.CENTER;delete l.fitBoundsPlacement;var F=l.degrees||0;delete l.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},l),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:E,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:S,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:b,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:F,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),O&&this.fitBounds(O,L,!0),this._drawingHandler=function(G){y.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:y},G))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(l){l!==this._fullyLoaded&&(this._fullyLoaded=l,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var l=this._xSpring.update(),y=this._ySpring.update(),E=this._scaleSpring.update(),S=this._degreesSpring.update();return l||y||E||S?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(l){return this.getBoundsNoRotate(l).rotate(this.getRotation(l),this._getRotationPoint(l))},getBoundsNoRotate:function(l){return l?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(l){var y=this.getBoundsNoRotate(l);if(this._clip){var E=l?this._worldWidthCurrent:this._worldWidthTarget,S=E/this.source.dimensions.x,b=this._clip.times(S);y=new e.Rect(y.x+b.x,y.y+b.y,b.width,b.height)}return y.rotate(this.getRotation(l),this._getRotationPoint(l))},getTileBounds:function(l,y,E){var S=this.source.getNumTiles(l),b=(S.x+y%S.x)%S.x,O=(S.y+E%S.y)%S.y,L=this.source.getTileBounds(l,b,O);return this.getFlip()&&(L.x=1-L.x-L.width),L.x+=(y-b)/S.x,L.y+=this._worldHeightCurrent/this._worldWidthCurrent*((E-O)/S.y),L},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var l=this.imageToWindowCoordinates(new e.Point(0,0)),y=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(y.x-l.x,y.y-l.y)},_viewportToImageDelta:function(l,y,E){var S=E?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(l*(this.source.dimensions.x/S),y*(this.source.dimensions.y*this.contentAspectX/S))},viewportToImageCoordinates:function(l,y,E){var S;return l instanceof e.Point?(E=y,S=l):S=new e.Point(l,y),S=S.rotate(-this.getRotation(E),this._getRotationPoint(E)),E?this._viewportToImageDelta(S.x-this._xSpring.current.value,S.y-this._ySpring.current.value):this._viewportToImageDelta(S.x-this._xSpring.target.value,S.y-this._ySpring.target.value)},_imageToViewportDelta:function(l,y,E){var S=E?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(l/this.source.dimensions.x*S,y/this.source.dimensions.y/this.contentAspectX*S)},imageToViewportCoordinates:function(l,y,E){l instanceof e.Point&&(E=y,y=l.y,l=l.x);var S=this._imageToViewportDelta(l,y);return E?(S.x+=this._xSpring.current.value,S.y+=this._ySpring.current.value):(S.x+=this._xSpring.target.value,S.y+=this._ySpring.target.value),S.rotate(this.getRotation(E),this._getRotationPoint(E))},imageToViewportRectangle:function(l,y,E,S,b){var O=l;O instanceof e.Rect?b=y:O=new e.Rect(l,y,E,S);var L=this.imageToViewportCoordinates(O.getTopLeft(),b),F=this._imageToViewportDelta(O.width,O.height,b);return new e.Rect(L.x,L.y,F.x,F.y,O.degrees+this.getRotation(b))},viewportToImageRectangle:function(l,y,E,S,b){var O=l;l instanceof e.Rect?b=y:O=new e.Rect(l,y,E,S);var L=this.viewportToImageCoordinates(O.getTopLeft(),b),F=this._viewportToImageDelta(O.width,O.height,b);return new e.Rect(L.x,L.y,F.x,F.y,O.degrees-this.getRotation(b))},viewerElementToImageCoordinates:function(l){var y=this.viewport.pointFromPixel(l,!0);return this.viewportToImageCoordinates(y)},imageToViewerElementCoordinates:function(l){var y=this.imageToViewportCoordinates(l);return this.viewport.pixelFromPoint(y,!0)},windowToImageCoordinates:function(l){var y=l.minus(A.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(y)},imageToWindowCoordinates:function(l){var y=this.imageToViewerElementCoordinates(l);return y.plus(A.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(l){var y=this._scaleSpring.current.value;return l=l.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((l.x-this._xSpring.current.value)/y,(l.y-this._ySpring.current.value)/y,l.width/y,l.height/y,l.degrees)},viewportToImageZoom:function(l){var y=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return y*l},imageToViewportZoom:function(l){var y=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return l/y},setPosition:function(l,y){var E=this._xSpring.target.value===l.x&&this._ySpring.target.value===l.y;if(y){if(E&&this._xSpring.current.value===l.x&&this._ySpring.current.value===l.y)return;this._xSpring.resetTo(l.x),this._ySpring.resetTo(l.y),this._needsDraw=!0}else{if(E)return;this._xSpring.springTo(l.x),this._ySpring.springTo(l.y),this._needsDraw=!0}E||this._raiseBoundsChange()},setWidth:function(l,y){this._setScale(l,y)},setHeight:function(l,y){this._setScale(l/this.normHeight,y)},setCroppingPolygons:function(l){var y=function(S){return S instanceof e.Point||typeof S.x=="number"&&typeof S.y=="number"},E=function(S){return S.map(function(b){try{if(y(b))return{x:b.x,y:b.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!e.isArray(l))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=l.map(function(S){return E(S)})}catch(S){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(S),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(l,y,E){y=y||e.Placement.CENTER;var S=e.Placement.properties[y],b=this.contentAspectX,O=0,L=0,F=1,G=1;if(this._clip&&(b=this._clip.getAspectRatio(),F=this._clip.width/this.source.dimensions.x,G=this._clip.height/this.source.dimensions.y,l.getAspectRatio()>b?(O=this._clip.x/this._clip.height*l.height,L=this._clip.y/this._clip.height*l.height):(O=this._clip.x/this._clip.width*l.width,L=this._clip.y/this._clip.width*l.width)),l.getAspectRatio()>b){var V=l.height/G,N=0;S.isHorizontallyCentered?N=(l.width-l.height*b)/2:S.isRight&&(N=l.width-l.height*b),this.setPosition(new e.Point(l.x-O+N,l.y-L),E),this.setHeight(V,E)}else{var q=l.width/F,j=0;S.isVerticallyCentered?j=(l.height-l.width/b)/2:S.isBottom&&(j=l.height-l.width/b),this.setPosition(new e.Point(l.x-O,l.y-L+j),E),this.setWidth(q,E)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(l){e.console.assert(!l||l instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),l instanceof e.Rect?this._clip=l.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(l){this.flipped=!!l,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(l){l!==this.opacity&&(this.opacity=l,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(l){this._preload=!!l,this._needsDraw=!0},getRotation:function(l){return l?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(l,y){this._degreesSpring.target.value===l&&this._degreesSpring.isAtTargetValue()||(y?this._degreesSpring.resetTo(l):this._degreesSpring.springTo(l),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(l){return this.getBoundsNoRotate(l).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(l){l!==this.compositeOperation&&(this.compositeOperation=l,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(l,y){var E=this._scaleSpring.target.value===l;if(y){if(E&&this._scaleSpring.current.value===l)return;this._scaleSpring.resetTo(l),this._updateForScale(),this._needsDraw=!0}else{if(E)return;this._scaleSpring.springTo(l),this._updateForScale(),this._needsDraw=!0}E||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var l=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),y=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,E=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(y/this.minPixelRatio)/Math.log(2))));return E=Math.max(E,this.source.minLevel||0),l=Math.min(l,E),{lowestLevel:l,highestLevel:E}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var l=this.lastDrawn.pop();l.beingDrawn=!1}var y=this.viewport,E=this._viewportToTiledImageRectangle(y.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var S=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(E=E.intersection(S),E===null)return}for(var b=this._getLevelsInterval(),O=b.lowestLevel,L=b.highestLevel,F=null,G=!1,V=e.now(),N=L;N>=O;N--){var q=!1,j=y.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(N),!0).x*this._scaleSpring.current.value;if(N===O||!G&&j>=this.minPixelRatio)q=!0,G=!0;else if(!G)continue;var J=y.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(N),!1).x*this._scaleSpring.current.value,K=y.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,te=this.immediateRender?1:K,$=Math.min(1,(j-.5)/.5),ne=te/Math.abs(te-J);if(F=t(this,G,q,N,$,ne,E,V,F),g(this.coverage,N))break}x(this,this.lastDrawn),F&&!F.context2D?(u(this,F,V),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(l,y,E){var S,b;this.wrapHorizontal?(S=e.positiveModulo(y.x,1),b=e.positiveModulo(E.x,1)):(S=Math.max(0,y.x),b=Math.min(1,E.x));var O,L,F=1/this.source.aspectRatio;this.wrapVertical?(O=e.positiveModulo(y.y,F),L=e.positiveModulo(E.y,F)):(O=Math.max(0,y.y),L=Math.min(F,E.y));var G=this.source.getTileAtPoint(l,new e.Point(S,O)),V=this.source.getTileAtPoint(l,new e.Point(b,L)),N=this.source.getNumTiles(l);return this.wrapHorizontal&&(G.x+=N.x*Math.floor(y.x),V.x+=N.x*Math.floor(E.x)),this.wrapVertical&&(G.y+=N.y*Math.floor(y.y/F),V.y+=N.y*Math.floor(E.y/F)),{topLeft:G,bottomRight:V}}});function t(l,y,E,S,b,O,L,F,G){var V=L.getBoundingBox().getTopLeft(),N=L.getBoundingBox().getBottomRight();l.viewer&&l.viewer.raiseEvent("update-level",{tiledImage:l,havedrawn:y,level:S,opacity:b,visibility:O,drawArea:L,topleft:V,bottomright:N,currenttime:F,best:G}),T(l.coverage,S),T(l.loadingCoverage,S);var q=l._getCornerTiles(S,V,N),j=q.topLeft,J=q.bottomRight,K=l.source.getNumTiles(S),te=l.viewport.pixelFromPoint(l.viewport.getCenter());l.getFlip()&&(J.x+=1,l.wrapHorizontal||(J.x=Math.min(J.x,K.x-1)));for(var $=j.x;$<=J.x;$++)for(var ne=j.y;ne<=J.y;ne++){var M;if(l.getFlip()){var ae=(K.x+$%K.x)%K.x;M=$+K.x-ae-ae-1}else M=$;L.intersection(l.getTileBounds(S,M,ne))!==null&&(G=i(l,E,y,M,ne,S,b,O,te,K,F,G))}return G}function i(l,y,E,S,b,O,L,F,G,V,N,q){var j=n(S,b,O,l,l.source,l.tilesMatrix,N,V,l._worldWidthCurrent,l._worldHeightCurrent),J=E;l.viewer&&l.viewer.raiseEvent("update-tile",{tiledImage:l,tile:j}),w(l.coverage,O,S,b,!1);var K=j.loaded||j.loading||p(l.loadingCoverage,O,S,b);if(w(l.loadingCoverage,O,S,b,K),!j.exists||(y&&!J&&(p(l.coverage,O,S,b)?w(l.coverage,O,S,b,!0):J=!0),!J))return q;if(s(j,l.source.tileOverlap,l.viewport,G,F,l),!j.loaded)if(j.context2D)r(l,j);else{var te=l._tileCache.getImageRecord(j.cacheKey);if(te){var $=te.getImage();r(l,j,$)}}if(j.loaded){var ne=d(l,j,S,b,O,L,N);ne&&(l._needsDraw=!0)}else j.loading?l._tilesLoading++:K||(q=P(q,j));return q}function n(l,y,E,S,b,O,L,F,G,V){var N,q,j,J,K,te,$,ne,M;return O[E]||(O[E]={}),O[E][l]||(O[E][l]={}),(!O[E][l][y]||!O[E][l][y].flipped!=!S.flipped)&&(N=(F.x+l%F.x)%F.x,q=(F.y+y%F.y)%F.y,j=S.getTileBounds(E,l,y),J=b.getTileBounds(E,N,q,!0),K=b.tileExists(E,N,q),te=b.getTileUrl(E,N,q),S.loadTilesWithAjax?($=b.getTileAjaxHeaders(E,N,q),e.isPlainObject(S.ajaxHeaders)&&($=e.extend({},S.ajaxHeaders,$))):$=null,ne=b.getContext2D?b.getContext2D(E,N,q):void 0,M=new e.Tile(E,l,y,j,K,te,ne,S.loadTilesWithAjax,$,J),S.getFlip()?N===0&&(M.isRightMost=!0):N===F.x-1&&(M.isRightMost=!0),q===F.y-1&&(M.isBottomMost=!0),M.flipped=S.flipped,O[E][l][y]=M),M=O[E][l][y],M.lastTouchTime=L,M}function u(l,y,E){y.loading=!0,l._imageLoader.addJob({src:y.url,loadWithAjax:y.loadWithAjax,ajaxHeaders:y.ajaxHeaders,crossOriginPolicy:l.crossOriginPolicy,ajaxWithCredentials:l.ajaxWithCredentials,callback:function(S,b,O){a(l,y,E,S,b,O)},abort:function(){y.loading=!1}})}function a(l,y,E,S,b,O){if(!S){e.console.log("Tile %s failed to load: %s - error: %s",y,y.url,b),l.viewer.raiseEvent("tile-load-failed",{tile:y,tiledImage:l,time:E,message:b,tileRequest:O}),y.loading=!1,y.exists=!1;return}if(E<l.lastResetTime){e.console.log("Ignoring tile %s loaded before reset: %s",y,y.url),y.loading=!1;return}var L=function(){var F=l.source.getClosestLevel();r(l,y,S,F,O)};l._midDraw?window.setTimeout(L,1):L()}function r(l,y,E,S,b){var O=0;function L(){return O++,F}function F(){O--,O===0&&(y.loading=!1,y.loaded=!0,y.context2D||l._tileCache.cacheTile({image:E,tile:y,cutoff:S,tiledImage:l}),l._needsDraw=!0)}l.viewer.raiseEvent("tile-loaded",{tile:y,tiledImage:l,tileRequest:b,image:E,getCompletionCallback:L}),L()()}function s(l,y,E,S,b,O){var L=l.bounds.getTopLeft();L.x*=O._scaleSpring.current.value,L.y*=O._scaleSpring.current.value,L.x+=O._xSpring.current.value,L.y+=O._ySpring.current.value;var F=l.bounds.getSize();F.x*=O._scaleSpring.current.value,F.y*=O._scaleSpring.current.value;var G=E.pixelFromPointNoRotate(L,!0),V=E.pixelFromPointNoRotate(L,!1),N=E.deltaPixelsFromPointsNoRotate(F,!0),q=E.deltaPixelsFromPointsNoRotate(F,!1),j=V.plus(q.divide(2)),J=S.squaredDistanceTo(j);y||(N=N.plus(new e.Point(1,1))),l.isRightMost&&O.wrapHorizontal&&(N.x+=.75),l.isBottomMost&&O.wrapVertical&&(N.y+=.75),l.position=G,l.size=N,l.squaredDistance=J,l.visibility=b}function d(l,y,E,S,b,O,L){var F=1e3*l.blendTime,G,V;if(y.blendStart||(y.blendStart=L),G=L-y.blendStart,V=F?Math.min(1,G/F):1,l.alwaysBlend&&(V*=O),y.opacity=V,l.lastDrawn.push(y),V===1)w(l.coverage,b,E,S,!0),l._hasOpaqueTile=!0;else if(G<F)return!0;return!1}function g(l,y,E,S){var b,O,L,F;if(!l[y])return!1;if(E===void 0||S===void 0){b=l[y];for(L in b)if(Object.prototype.hasOwnProperty.call(b,L)){O=b[L];for(F in O)if(Object.prototype.hasOwnProperty.call(O,F)&&!O[F])return!1}return!0}return l[y][E]===void 0||l[y][E][S]===void 0||l[y][E][S]===!0}function p(l,y,E,S){return E===void 0||S===void 0?g(l,y+1):g(l,y+1,2*E,2*S)&&g(l,y+1,2*E,2*S+1)&&g(l,y+1,2*E+1,2*S)&&g(l,y+1,2*E+1,2*S+1)}function w(l,y,E,S,b){if(!l[y]){e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",y);return}l[y][E]||(l[y][E]={}),l[y][E][S]=b}function T(l,y){l[y]={}}function P(l,y){return!l||y.visibility>l.visibility||y.visibility===l.visibility&&y.squaredDistance<l.squaredDistance?y:l}function x(l,y){if(!(l.opacity===0||y.length===0&&!l.placeholderFillStyle)){var E=y[0],S;E&&(S=l.opacity<1||l.compositeOperation&&l.compositeOperation!=="source-over"||!l._isBottomItem()&&E._hasTransparencyChannel());var b,O,L=l.viewport.getZoom(!0),F=l.viewportToImageZoom(L);y.length>1&&F>l.smoothTileEdgesMinZoom&&!l.iOSDevice&&l.getRotation(!0)%360===0&&e.supportsCanvas&&(S=!0,b=E.getScaleForEdgeSmoothing(),O=E.getTranslationForEdgeSmoothing(b,l._drawer.getCanvasSize(!1),l._drawer.getCanvasSize(!0)));var G;S&&(b||(G=l.viewport.viewportToViewerElementRectangle(l.getClippedBounds(!0)).getIntegerBoundingBox(),l._drawer.viewer.viewport.getFlip()&&(l.viewport.degrees!==0||l.getRotation(!0)%360!==0)&&(G.x=l._drawer.viewer.container.clientWidth-(G.x+G.width)),G=G.times(e.pixelDensityRatio)),l._drawer._clear(!0,G)),b||(l.viewport.degrees!==0&&l._drawer._offsetForRotation({degrees:l.viewport.degrees,useSketch:S}),l.getRotation(!0)%360!==0&&l._drawer._offsetForRotation({degrees:l.getRotation(!0),point:l.viewport.pixelFromPointNoRotate(l._getRotationPoint(!0),!0),useSketch:S}),l.viewport.degrees===0&&l.getRotation(!0)%360===0&&l._drawer.viewer.viewport.getFlip()&&l._drawer._flip());var V=!1;if(l._clip){l._drawer.saveContext(S);var N=l.imageToViewportRectangle(l._clip,!0);N=N.rotate(-l.getRotation(!0),l._getRotationPoint(!0));var q=l._drawer.viewportToDrawerRectangle(N);b&&(q=q.times(b)),O&&(q=q.translate(O)),l._drawer.setClip(q,S),V=!0}if(l._croppingPolygons){l._drawer.saveContext(S);try{var j=l._croppingPolygons.map(function($){return $.map(function(ne){var M=l.imageToViewportCoordinates(ne.x,ne.y,!0).rotate(-l.getRotation(!0),l._getRotationPoint(!0)),ae=l._drawer.viewportCoordToDrawerCoord(M);return b&&(ae=ae.times(b)),ae})});l._drawer.clipWithPolygons(j,S)}catch($){e.console.error($)}V=!0}if(l.placeholderFillStyle&&l._hasOpaqueTile===!1){var J=l._drawer.viewportToDrawerRectangle(l.getBounds(!0));b&&(J=J.times(b)),O&&(J=J.translate(O));var K=null;typeof l.placeholderFillStyle=="function"?K=l.placeholderFillStyle(l,l._drawer.context):K=l.placeholderFillStyle,l._drawer.drawRectangle(J,K,S)}for(var te=y.length-1;te>=0;te--)E=y[te],l._drawer.drawTile(E,l._drawingHandler,S,b,O),E.beingDrawn=!0,l.viewer&&l.viewer.raiseEvent("tile-drawn",{tiledImage:l,tile:E});V&&l._drawer.restoreContext(S),b||(l.getRotation(!0)%360!==0&&l._drawer._restoreRotationChanges(S),l.viewport.degrees!==0&&l._drawer._restoreRotationChanges(S)),S&&(b&&(l.viewport.degrees!==0&&l._drawer._offsetForRotation({degrees:l.viewport.degrees,useSketch:!1}),l.getRotation(!0)%360!==0&&l._drawer._offsetForRotation({degrees:l.getRotation(!0),point:l.viewport.pixelFromPointNoRotate(l._getRotationPoint(!0),!0),useSketch:!1})),l._drawer.blendSketch({opacity:l.opacity,scale:b,translate:O,compositeOperation:l.compositeOperation,bounds:G}),b&&(l.getRotation(!0)%360!==0&&l._drawer._restoreRotationChanges(!1),l.viewport.degrees!==0&&l._drawer._restoreRotationChanges(!1))),b||l.viewport.degrees===0&&l.getRotation(!0)%360===0&&l._drawer.viewer.viewport.getFlip()&&l._drawer._flip(),R(l,y)}}function R(l,y){if(l.debugMode)for(var E=y.length-1;E>=0;E--){var S=y[E];try{l._drawer.drawDebugInfo(S,y.length,E,l)}catch(b){e.console.error(b)}}}}(A),function(e){var t=function(n){e.console.assert(n,"[TileCache.cacheTile] options is required"),e.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=n.tile,this.tiledImage=n.tiledImage},i=function(n){e.console.assert(n,"[ImageRecord] options is required"),e.console.assert(n.image,"[ImageRecord] options.image is required"),this._image=n.image,this._tiles=[]};i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var n=document.createElement("canvas");n.width=this._image.width,n.height=this._image.height,this._renderedContext=n.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(n){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=n},addTile:function(n){e.console.assert(n,"[ImageRecord.addTile] tile is required"),this._tiles.push(n)},removeTile:function(n){for(var u=0;u<this._tiles.length;u++)if(this._tiles[u]===n){this._tiles.splice(u,1);return}e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",n)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(n){n=n||{},this._maxImageCacheCount=n.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){e.console.assert(n,"[TileCache.cacheTile] options is required"),e.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var u=n.cutoff||0,a=this._tilesLoaded.length,r=this._imagesLoaded[n.tile.cacheKey];if(r||(e.console.assert(n.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),r=this._imagesLoaded[n.tile.cacheKey]=new i({image:n.image}),this._imagesLoadedCount++),r.addTile(n.tile),n.tile.cacheImageRecord=r,this._imagesLoadedCount>this._maxImageCacheCount){for(var s=null,d=-1,g=null,p,w,T,P,x,R,l=this._tilesLoaded.length-1;l>=0;l--)if(R=this._tilesLoaded[l],p=R.tile,!(p.level<=u||p.beingDrawn)){if(!s){s=p,d=l,g=R;continue}P=p.lastTouchTime,w=s.lastTouchTime,x=p.level,T=s.level,(P<w||P===w&&x>T)&&(s=p,d=l,g=R)}s&&d>=0&&(this._unloadTile(g),a=d)}this._tilesLoaded[a]=new t({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(n){e.console.assert(n,"[TileCache.clearTilesFor] tiledImage is required");for(var u,a=0;a<this._tilesLoaded.length;++a)u=this._tilesLoaded[a],u.tiledImage===n&&(this._unloadTile(u),this._tilesLoaded.splice(a,1),a--)},getImageRecord:function(n){return e.console.assert(n,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[n]},_unloadTile:function(n){e.console.assert(n,"[TileCache._unloadTile] tileRecord is required");var u=n.tile,a=n.tiledImage;u.unload(),u.cacheImageRecord=null;var r=this._imagesLoaded[u.cacheKey];r.removeTile(u),r.getTileCount()||(r.destroy(),delete this._imagesLoaded[u.cacheKey],this._imagesLoadedCount--),a.viewer.raiseEvent("tile-unloaded",{tile:u,tiledImage:a})}}}(A),function(e){e.World=function(t){var i=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(n){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,i){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),i=i||{},i.index!==void 0){var n=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(n,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(t!==void 0,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,i){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(i!==void 0,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(t);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i===n||n===-1||(this._items.splice(n,1),this._items.splice(i,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:n,newIndex:i}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var i=e.indexOf(this._items,t);i!==-1&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){this.viewer._cancelPendingImages();var t,i;for(i=0;i<this._items.length;i++)t=this._items[i],t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy();var n=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<n.length;i++)t=n[i],this._raiseRemoveItem(t)},resetItems:function(){for(var t=0;t<this._items.length;t++)this._items[t].reset()},update:function(){for(var t=!1,i=0;i<this._items.length;i++)t=this._items[i].update()||t;return t},draw:function(){for(var t=0;t<this._items.length;t++)this._items[t].draw();this._needsDraw=!1},needsDraw:function(){for(var t=0;t<this._items.length;t++)if(this._items[t].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(t){this._autoRefigureSizes=t,t&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){t=t||{};var i=t.immediately||!1,n=t.layout||e.DEFAULT_SETTINGS.collectionLayout,u=t.rows||e.DEFAULT_SETTINGS.collectionRows,a=t.columns||e.DEFAULT_SETTINGS.collectionColumns,r=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,s=t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin,d=r+s,g;!t.rows&&a?g=a:g=Math.ceil(this._items.length/u);var p=0,w=0,T,P,x,R,l;this.setAutoRefigureSizes(!1);for(var y=0;y<this._items.length;y++)y&&y%g===0&&(n==="horizontal"?(w+=d,p=0):(p+=d,w=0)),T=this._items[y],P=T.getBounds(),P.width>P.height?x=r:x=r*(P.width/P.height),R=x*(P.height/P.width),l=new e.Point(p+(r-x)/2,w+(r-R)/2),T.setPosition(l,i),T.setWidth(x,i),n==="horizontal"?p+=d:w+=d;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(!this._items.length)this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;else{var u=this._items[0],a=u.getBounds();this._contentFactor=u.getContentSize().x/a.width;for(var r=u.getClippedBounds().getBoundingBox(),s=r.x,d=r.y,g=r.x+r.width,p=r.y+r.height,w=1;w<this._items.length;w++)u=this._items[w],a=u.getBounds(),this._contentFactor=Math.max(this._contentFactor,u.getContentSize().x/a.width),r=u.getClippedBounds().getBoundingBox(),s=Math.min(s,r.x),d=Math.min(d,r.y),g=Math.max(g,r.x+r.width),p=Math.max(p,r.y+r.height);this._homeBounds=new e.Rect(s,d,g-s,p-d),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==n||!this._homeBounds.equals(t)||!this._contentSize.equals(i))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(t){this.raiseEvent("remove-item",{item:t})}})}(A)})(Se);var De=Se.exports,Oe=Object.freeze(Re({__proto__:null,[Symbol.toStringTag]:"Module",default:De},[Se.exports]));export{De as O,Se as a,Oe as o};
